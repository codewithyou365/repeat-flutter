"use strict";(self.webpackChunktyping=self.webpackChunktyping||[]).push([["174"],{268:function(e,t,s){s.d(t,{Z:()=>o});var n=s("881");let a={class:"typing-line"},i=["data-index","onClick","onPointerover","onPointerdown"],l=["disabled"],r=(0,n.aZ)({__name:"typing",props:{disabled:{type:Boolean},content:{},clickFillCharWhenDisabled:{default:""},ignoreContentIndexes:{},ignoreCase:{type:Boolean},ignorePunctuation:{type:Boolean}},setup(e,t){let{expose:s}=t,r=(0,n.iH)(""),o=(0,n.iH)(""),u=(0,n.iH)(null),h=(0,n.iH)(null),c=(0,n.iH)([]),d=(0,n.iH)(0),g=(0,n.iH)(0),v=(0,n.iH)(0),_=(0,n.Fl)(()=>e.content?e.content.split(""):[]),p=(0,n.Fl)(()=>/[\u4e00-\u9fff\u3040-\u309f\u30a0-\u30ff]/.test(e.content)),T=(0,n.Fl)(()=>e.disabled),N=(0,n.Fl)(()=>{let t=[];if(p.value)e.content.split("").forEach((e,s)=>{t.push({type:" "===e?"space":"char",char:e,index:s})});else{let s=[];e.content.split("").forEach((e,n)=>{" "===e?(s.length&&(t.push({type:"word",chars:s}),s=[]),t.push({type:"space",char:e,index:n})):s.push({char:e,index:n})}),s.length&&t.push({type:"word",chars:s})}return t}),C=(0,n.iH)(!1),S=(e,t)=>{e&&(c.value[t]=e)};(0,n.bv)(()=>{window.addEventListener("resize",b),f()}),(0,n.Jd)(()=>{window.removeEventListener("resize",b)});let f=async()=>{var e;await (0,n.Y3)(),null===(e=u.value)||void 0===e||e.focus(),b()},I=()=>{C.value=!0},O=e=>{C.value=!1,w(e.target.value),o.value=""};(0,n.YP)(o,e=>{if(!C.value)e.length>0&&(w(e),o.value="")});let E=(t,s)=>!!(e.ignorePunctuation&&/\p{P}/u.test(t))||void 0!==e.ignoreContentIndexes&&e.ignoreContentIndexes.includes(s),w=t=>{let s=d.value,n=r.value;for(let a of t){for(;s<e.content.length&&E(e.content[s],s);)s>=n.length&&(n+=e.content[s]),s++;s<n.length?n=n.slice(0,s)+a+n.slice(s+1):n+=a,s++}for(;s<e.content.length&&E(e.content[s],s);)s>=n.length&&(n+=e.content[s]),s++;r.value=n,d.value=s,r.value.length>e.content.length&&(r.value=r.value.slice(0,e.content.length)),d.value>e.content.length&&(d.value=e.content.length)},R=(t,s)=>{if(T.value&&1===e.clickFillCharWhenDisabled.length){if("end"===s){v.value=null;return}let e=t.touches[0],n=e.clientX,a=e.clientY,i=document.elementFromPoint(n,a);if(null==i?void 0:i.classList.contains("typing-char")){let e=Number(i.dataset.index);!Number.isNaN(e)&&e!==v.value&&(m(null,e),v.value=e)}else v.value=null;"move"===s&&t.preventDefault()}},m=(t,s)=>{if(T.value&&(null==t||1===t.buttons)){if(1===e.clickFillCharWhenDisabled.length){o.value="";if(s>=0&&s<r.value.length){let t=e.clickFillCharWhenDisabled;r.value[s]===e.clickFillCharWhenDisabled&&(t=e.content[s]),r.value=r.value.slice(0,s)+t+r.value.slice(s+1)}}return}},y=e=>{if(!T.value)d.value=Math.min(e,r.value.length),o.value="",b(),f()},k=()=>{d.value<g.value&&(r.value=e.content.slice(0,g.value),d.value=g.value)},F=t=>{if(!C.value){if("Backspace"===t.key){let s=d.value;if(d.value===r.value.length||E(e.content[s],s)){for(s=d.value;E(e.content[s],s)&&s<r.value.length;)s++;if(s===r.value.length&&(r.value=r.value.slice(0,d.value),d.value=r.value.length),d.value===r.value.length&&d.value>0)for(r.value=r.value.slice(0,d.value-1)+r.value.slice(d.value),d.value--;E(e.content[d.value],d.value)&&(r.value=r.value.slice(0,d.value-1)+r.value.slice(d.value),d.value--,0!=d.value););k(),b()}else{for(s++;E(e.content[s],s)&&s<r.value.length;)s++;s===r.value.length&&(r.value=r.value.slice(0,d.value),d.value=r.value.length)}t.preventDefault()}else if("ArrowLeft"===t.key){if(d.value>0){for(d.value--;E(e.content[d.value],d.value);)d.value--;b()}t.preventDefault()}else if("ArrowRight"===t.key){if(d.value<r.value.length){for(d.value++;E(e.content[d.value],d.value);)d.value++;b()}t.preventDefault()}}},H=e=>{let t=_.value[e];return e>=r.value.length?" "===t?"⎵":E(t,e)?t:"":" "===r.value[e]?"⎵":r.value[e]},P=t=>{let s=[],n=E(_.value[t],t);if(t>=r.value.length)n?s.push("pending-ignore"):s.push("pending");else{let a=r.value[t],i=_.value[t],l=a===i;e.ignoreCase&&(l=a.toLowerCase()===i.toLowerCase()),n&&l?s.push("ignore-correct"):l?s.push("correct"):s.push("wrong")}return t===d.value&&t<_.value.length&&s.push("flashing"),s},b=()=>{if(!u.value||!h.value||!c.value.length)return;let t=d.value,s=t<e.content.length?t:e.content.length-1,n=c.value[s];if(n){let e=n.getBoundingClientRect(),t=h.value.getBoundingClientRect();u.value.style.left=`${e.left-t.left}px`,u.value.style.top=`${e.top-t.top}px`,u.value.style.width=`${e.width}px`,u.value.style.height=`${e.height}px`,u.value.style.fontSize=getComputedStyle(n).fontSize,u.value.style.lineHeight=getComputedStyle(n).lineHeight}};return(0,n.YP)(()=>e.content,async()=>{var t;for(r.value="",d.value=0,c.value=Array(e.content.length),await (0,n.Y3)(),g.value=0;E(e.content[g.value],g.value);)g.value++;k(),b(),null===(t=u.value)||void 0===t||t.focus()}),(0,n.YP)([r,N],async()=>{await (0,n.Y3)(),b()}),s({initUserInput(e){r.value=e,d.value=e.length,(0,n.Y3)(b)},getUserInput:()=>r.value}),(e,t)=>((0,n.wg)(),(0,n.iD)("label",null,[(0,n._)("div",{class:"typing",ref_key:"containerRef",ref:h,onClick:f},[(0,n._)("div",a,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(N.value,(e,s)=>((0,n.wg)(),(0,n.iD)(n.HY,{key:s},["word"===e.type?((0,n.wg)(),(0,n.iD)("span",{key:0,class:"word",onTouchstart:t[0]||(t[0]=e=>R(e,"start")),onTouchmove:t[1]||(t[1]=e=>R(e,"move")),onTouchend:t[2]||(t[2]=e=>R(e,"end"))},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.chars,(e,t)=>((0,n.wg)(),(0,n.iD)("span",{key:t,class:(0,n.C_)(["typing-char",P(e.index)]),"data-index":e.index,ref_for:!0,ref:t=>S(t,e.index),onClick:t=>y(e.index),onPointerover:t=>m(t,e.index),onPointerdown:t=>m(t,e.index)},(0,n.zw)(H(e.index)),43,i))),128))],32)):((0,n.wg)(),(0,n.iD)("span",{key:1,class:(0,n.C_)(["typing-char",[P(e.index),"space"===e.type?"space":""]]),ref_for:!0,ref:t=>S(t,e.index)},(0,n.zw)(H(e.index)),3))],64))),128))]),(0,n.wy)((0,n._)("input",{ref_key:"inputRef",ref:u,disabled:T.value,"onUpdate:modelValue":t[3]||(t[3]=e=>o.value=e),onCompositionstart:I,onCompositionend:O,onKeydown:F,class:"overlay-input",autocomplete:"off",spellcheck:"false"},null,40,l),[[n.nr,o.value]])],512)]))}}),o=(0,s("465").default)(r,[["__scopeId","data-v-0aa1bfb3"]])},687:function(e,t,s){s.d(t,{HM:function(){return o},HQ:function(){return a},Lp:function(){return p},cf:function(){return r},wJ:function(){return c}});var n=s(438);let a=`wss://${window.location.hostname}:${window.location.port}`,i={REQUEST:0,RESPONSE:1},l={age:"age"};class r{static fromJson(e){return new r({path:e.path??"",headers:e.headers||new Map,data:e.data??""})}constructor({path:e="",headers:t=new Map,data:s=""}={}){(0,n._)(this,"path",void 0),(0,n._)(this,"headers",void 0),(0,n._)(this,"data",void 0),this.path=e,this.headers=t,this.data=s}}class o{static fromJson(e){return new o({headers:e.headers||new Map,data:e.data??"",error:e.error??"",status:e.status??200})}constructor({headers:e=new Map,data:t="",error:s="",status:a=200}={}){(0,n._)(this,"headers",void 0),(0,n._)(this,"data",void 0),(0,n._)(this,"error",void 0),(0,n._)(this,"status",void 0),this.headers=e,this.data=t,this.error=s,this.status=a}}class u{static fromJson(e){return new u({type:e.type,id:e.id||0,age:e.age||0,request:e.request?r.fromJson(e.request):null,response:e.response?o.fromJson(e.response):null})}constructor({type:e=i.REQUEST,id:t=0,age:s=0,request:a=null,response:l=null}={}){(0,n._)(this,"type",void 0),(0,n._)(this,"id",void 0),(0,n._)(this,"age",void 0),(0,n._)(this,"request",void 0),(0,n._)(this,"response",void 0),this.type=e,this.id=t,this.age=s,this.request=a,this.response=l}}class h{receive(e){if(e.age!==this.age){console.log(`[ws] ignoring message - age mismatch: ${e.age} vs ${this.age}`);return}let t=this.sendId2Res.get(e.id);if(t){let s=new Map;s.set(l.age,`${this.age}`),e.response.headers=s,t.resolve(e.response),this.sendId2Res.delete(e.id)}this.sendId2Log.get(e.id)&&(console.log("[ws] recv :",e),this.sendId2Log.delete(e.id))}async send(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.sendId++;let s=this.sendId,n=this.age,a=new u({id:s,age:n,type:i.REQUEST,request:e});t&&console.log("[ws] send :",a),this.webSocket.send(JSON.stringify(a));let r=this._createCompleter();this.sendId2Res.set(s,r),this.sendId2Log.set(s,t);let h=setTimeout(()=>{if(this.sendId2Res.delete(s)){this.sendId2Log.delete(s);let e=new Map;e.set(l.age,`${n}`),r.resolve(new o({headers:e,error:"timeout",status:504}))}},1e4);try{return await r.promise}finally{clearTimeout(h),this.sendId2Res.delete(s),this.sendId2Log.delete(s)}}_createCompleter(){let e,t;return{promise:new Promise((s,n)=>{e=s,t=n}),resolve:e,reject:t}}constructor(e,t){(0,n._)(this,"sendId",void 0),(0,n._)(this,"sendId2Res",void 0),(0,n._)(this,"sendId2Log",void 0),(0,n._)(this,"webSocket",void 0),(0,n._)(this,"age",void 0),this.sendId=0,this.sendId2Res=new Map,this.sendId2Log=new Map,this.webSocket=e,this.age=t}}let c={INIT:0,CONNECT_START:1,CONNECT_FAILED:2,CONNECT_FINISH:3,CONNECT_CLOSE:4,STOP_START:5,STOP_FINISH:6,STOP_FOR_RECONNECT_START:7,STOP_FOR_RECONNECT_FINISH:8},d=new Map([[0,"INIT"],[1,"CONNECT_START"],[2,"CONNECT_FAILED"],[3,"CONNECT_FINISH"],[4,"CONNECT_CLOSE"],[5,"STOP_START"],[6,"STOP_FINISH"],[7,"STOP_FOR_RECONNECT_START"],[8,"STOP_FOR_RECONNECT_FINISH"]]),g=new Map;function v(e,t,s){let n=new Map;for(let e of s)n.set(e,!0);g.set(e,{to:e,incAge:t,from:n})}v(c.INIT,!1,[]),v(c.CONNECT_START,!0,[c.INIT,c.STOP_FOR_RECONNECT_FINISH,c.CONNECT_CLOSE]),v(c.CONNECT_FAILED,!1,[c.CONNECT_START,c.CONNECT_FINISH]),v(c.CONNECT_FINISH,!1,[c.CONNECT_START]),v(c.CONNECT_CLOSE,!0,[c.CONNECT_FINISH]),v(c.STOP_START,!0,[c.CONNECT_FAILED,c.CONNECT_FINISH]),v(c.STOP_FINISH,!0,[c.STOP_START]),v(c.STOP_FOR_RECONNECT_START,!0,[c.CONNECT_FAILED,c.CONNECT_FINISH]),v(c.STOP_FOR_RECONNECT_FINISH,!0,[c.STOP_FOR_RECONNECT_START]);class _{constructor(){(0,n._)(this,"url",""),(0,n._)(this,"statusChange",()=>{}),(0,n._)(this,"heartSender",async()=>new o({status:200})),(0,n._)(this,"reason","")}}let p=new class e{async _loopHeart(){this.heart&&clearTimeout(this.heart);let e=-1;try{let t=await this.heartSender();e=parseInt(t.headers.get(l.age)??"-1"),200===t.status&&""===t.error?this.heart=setTimeout(()=>{this._loopHeart()},2e3):e===this.age&&this.stop(!0,"heart error:"+t.error)}catch(t){e===this.age&&this.stop(!0,"heart exception")}}async send(e){return this.node?await this.node.send(e):null}start(e,t,s){if(this.status!==c.INIT&&this.status!==c.CONNECT_CLOSE&&this.status!==c.STOP_FOR_RECONNECT_FINISH)return this.logger(`[ws] start: status error :${d.get(this.status)}`),!1;{let n=new _;return n.url=e,n.statusChange=t,n.heartSender=s,this.setStatus(c.CONNECT_START,n),!0}}stop(e,t){if(this.status!=c.CONNECT_FAILED&&this.status!=c.CONNECT_FINISH)return this.logger(`[ws] stop: status error :${d.get(this.status)} ${t}`),!1;{let s=new _;return s.reason=t,e?this.setStatus(c.STOP_FOR_RECONNECT_START,s):this.setStatus(c.STOP_START,s),!0}}_close(){this.node.webSocket.close()}_start(e,t,s){this.url=e,this.statusChange=t,this.heartSender=s;let n=new WebSocket(e);this.node=new h(n,this.age),n.onmessage=async e=>{if(this.status===c.CONNECT_FINISH)try{let t=e.data,s=u.fromJson(JSON.parse(t));if(s.type===i.RESPONSE){if(s.age!==this.age)return;this.node.receive(s)}else s.type===i.REQUEST?(console.log("[ws] recv :",s),await this._responseHandler(this.controllers,s,n)):(console.log("[ws] recv :",s),this.logger(`Unknown message type: ${s.type}`))}catch(e){this.logger(`Error handling WebSocket message: ${e}`)}},n.onclose=e=>{this.status===c.CONNECT_FINISH?this.setStatus(c.CONNECT_CLOSE,null):this.status===c.STOP_START?this.setStatus(c.STOP_FINISH,null):this.status===c.STOP_FOR_RECONNECT_START?this.setStatus(c.STOP_FOR_RECONNECT_FINISH,null):this.logger(`[ws] socket.onclose: status error :${d.get(this.status)}`)},n.onerror=e=>{this.status==c.CONNECT_START||this.status==c.CONNECT_FINISH?this.setStatus(c.CONNECT_FAILED,null):this.logger(`[ws] socket.onerror: status error :${d.get(this.status)}`)},n.onopen=()=>{this.status==c.CONNECT_START?this.setStatus(c.CONNECT_FINISH,null):this.logger(`[ws] socket.onopen: status error :${d.get(this.status)}`)}}setStatus(e,t){let s=g.get(e);if(void 0===s)throw Error(`Unknown status: ${e}`);if(!s.from.get(this.status)){this.logger(`[ws] status error : cant from ${d.get(this.status)} to ${d.get(e)} ${null==t?void 0:t.reason}`);return}switch(s.incAge&&this.age++,this.logger(`[ws] status from ${d.get(this.status)} to ${d.get(e)} ${null==t?void 0:t.reason}`),this.status=e,e){case c.CONNECT_START:this._start(t.url,t.statusChange,t.heartSender);break;case c.CONNECT_FAILED:this.stop(!0,"connect failed");break;case c.CONNECT_FINISH:this._loopHeart();break;case c.STOP_FOR_RECONNECT_START:case c.STOP_START:this._close();break;case c.STOP_FINISH:case c.STOP_FOR_RECONNECT_FINISH:case c.CONNECT_CLOSE:this.heart&&clearTimeout(this.heart),this.retry&&clearTimeout(this.retry),(e===c.STOP_FOR_RECONNECT_FINISH||e===c.CONNECT_CLOSE)&&(this.retry=setTimeout(()=>{this.start(this.url,this.statusChange,this.heartSender)},1e3))}this.statusChange(this.status)}async _responseHandler(e,t,s){let n;let a=t.request,l=a&&e.get(a.path);if(l)try{n=await l(a)||new o({status:501})}catch(t){let e;n=new o({status:500,error:e=t instanceof Error?t.message:String(t)})}else n=new o({status:404});let r=new u({id:t.id,type:i.RESPONSE,response:n});s.send(JSON.stringify(r))}constructor(e=console.log){(0,n._)(this,"logger",void 0),(0,n._)(this,"age",0),(0,n._)(this,"node",void 0),(0,n._)(this,"status",c.INIT),(0,n._)(this,"url",""),(0,n._)(this,"retry",null),(0,n._)(this,"statusChange",()=>{}),(0,n._)(this,"controllers",void 0),(0,n._)(this,"heart",null),(0,n._)(this,"heartSender",async()=>new o({status:200})),this.logger=e,this.node=null,this.controllers=new Map}}},151:function(e,t,s){s.d(t,{D$:function(){return l},_q:function(){return u},bY:function(){return o},ot:function(){return r},y$:function(){return i}});var n,a=s(438);let i={kick:"/api/kick",refreshGame:"/api/refreshGame",heart:"/api/heart",loginOrRegister:"/api/loginOrRegister",entryGame:"/api/entryGame",gameUserHistory:"/api/gameUserHistory",gameUserScore:"/api/gameUserScore",gameUserScoreHistory:"/api/gameUserScoreHistory",gameUserScoreMinus:"/api/gameUserScoreMinus",typeGameSettings:"/api/typeGameSettings",typeVerseContent:"/api/typeVerseContent",blankItRightSettings:"/api/blankItRightSettings",blankItRightContent:"/api/blankItRightContent",blankItRightBlank:"/api/blankItRightBlank",blankItRightSubmit:"/api/blankItRightSubmit",submit:"/api/submit"};class l{static toGameType(e){switch(e){case l.TYPE.code:return l.TYPE;case l.BLANK_IT_RIGHT.code:return l.BLANK_IT_RIGHT;case l.INPUT.code:return l.INPUT;default:return l.NONE}}constructor(e,t){(0,a._)(this,"code",void 0),(0,a._)(this,"path",void 0),this.code=e,this.path=t}}(0,a._)(l,"NONE",new l(0,"")),(0,a._)(l,"TYPE",new l(1,"/game/type-game")),(0,a._)(l,"BLANK_IT_RIGHT",new l(2,"/game/blank-it-right-game")),(0,a._)(l,"INPUT",new l(3,"/game/input-game"));class r{static from(e){let t=new r;return t.list=e.list,t.tips=e.tips,t}constructor(){(0,a._)(this,"list",void 0),(0,a._)(this,"tips",void 0),this.list=[],this.tips=[]}}class o{static from(e){let t=new o;return t.gameId=e.gameId||0,t.prevId=e.prevId||0,t.input=e.input||"",t}constructor(){(0,a._)(this,"gameId",void 0),(0,a._)(this,"prevId",void 0),(0,a._)(this,"input",void 0),this.gameId=0,this.prevId=0,this.input=""}}var u=((n={})[n.word=0]="word",n[n.single=1]="single",n[n.all=2]="all",n)},910:function(e,t,s){s.d(t,{r:()=>i});var n=s("438");class a{static fromJson(e){return new a(e.k,e.v)}toJson(){return{k:this.k,v:this.v}}constructor(e,t){(0,n._)(this,"k",void 0),(0,n._)(this,"v",void 0),this.k=e,this.v=t}}class i{static fromJson(e){return new i((e.list??[]).map(e=>a.fromJson(e)))}convertMap(){let e=new Map;for(let t of this.list)e.set(t.k,t.v);return e}constructor(e){(0,n._)(this,"list",void 0),this.list=e}}}}]);