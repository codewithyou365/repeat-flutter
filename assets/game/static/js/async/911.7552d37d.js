"use strict";(self.webpackChunktyping=self.webpackChunktyping||[]).push([["911"],{709:function(e,t,l){l.r(t),l.d(t,{default:()=>b});var n=l("438"),i=l("881"),a=l("13"),o=l("151"),s=l("494"),u=l("987"),c=l("946"),r=l("687"),v=l("702"),d=l("556");let f={class:"container"},m={class:"overlay-body"},p={class:"overlay-content"},y=(0,i.aZ)({__name:"editor",setup(e){let t;let l=(0,i.iH)(!1),y=(0,i.iH)(!1),b=(0,i.iH)(new class e{constructor(){(0,n._)(this,"content",""),(0,n._)(this,"visible",!1),(0,n._)(this,"code","")}}),{t:h}=(0,c.QT)(),k=(0,d.yj)(),w=(0,d.tv)(),g=(0,i.iH)(null),S=(0,i.iH)(null);(0,i.bv)(async()=>{t=a.km.from(k.query),await _(t),(0,a.$x)().on(a.B_.RefreshGame,e=>{t=e,_(e)}),(0,a.$x)().on(a.B_.WsStatus,e=>{e===r.wJ.CONNECT_FINISH&&w.push("/loading")}),window.addEventListener("keydown",x)}),(0,i.Jd)(()=>{(0,a.$x)().off(a.B_.RefreshGame),(0,a.$x)().off(a.B_.WsStatus),window.removeEventListener("keydown",x)});let _=async e=>{try{l.value=!0;let t={gameId:e.id},n=new r.cf({path:o.y$.getSegmentContent,data:t}),i=await r.Lp.node.send(n),a=o.ZQ.from(i.data),s=JSON.stringify(JSON.parse(a.content),null,2);if(g.value){let e=g.value.getEditorView();e&&(e.dispatch({changes:{from:0,to:null==e?void 0:e.state.doc.length,insert:s}}),console.log(e.state.doc.toString()))}await w.replace({query:{id:e.id,time:e.time}})}catch(e){console.error("Failed to refresh game:",e)}finally{l.value=!1}},U=()=>{b.value.visible=!1,""===b.value.code||("editModeDisabled"===b.value.code?history.back():w.push("/home"))},x=e=>{let t=!1;y.value&&("Escape"===e.key?(y.value=!1,t=!0):"Enter"===e.key&&(y.value=!1,E())),b.value.visible&&("Escape"===e.key?(b.value.visible=!1,t=!0):"Enter"===e.key&&(b.value.visible=!1,t=!0)),t&&(0,i.Y3)(()=>{g.value&&g.value.focus()})},C=()=>{y.value=!0,(0,i.Y3)(()=>{S.value&&S.value.focus()})},E=async()=>{let e="";if(g.value){let t=g.value.getEditorView();t&&(e=t.state.doc.toString())}if(""===e){b.value.visible=!0,b.value.code="emptyContent",b.value.content=h("emptyContent");return}try{l.value=!0;let n={gameId:t.id,content:e};l.value=!0;let i=new r.cf({path:o.y$.setSegmentContent,data:n}),a=await r.Lp.node.send(i);b.value.visible=!0,b.value.code=a.error,a.error?b.value.content=h(a.error):b.value.content=h("success")}catch(e){console.error("Failed to refresh game:",e)}finally{l.value=!1}},W=()=>history.back();return(e,t)=>{let n=(0,i.up)("router-link"),a=(0,i.up)("nut-navbar"),o=(0,i.up)("nut-button"),c=(0,i.up)("nut-dialog"),r=(0,i.up)("nut-overlay");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(a,{title:(0,i.SU)(h)("edit"),"left-show":"",onClickBack:W},{right:(0,i.w5)(()=>[(0,i.Wm)(n,{to:"/settings"},{default:(0,i.w5)(()=>[(0,i.Wm)((0,i.SU)(u.pE),{width:"16px"})]),_:1})]),_:1},8,["title"]),(0,i.Wm)(s.Z),(0,i.Wm)(v.Z,{type:"json",save:C,ref_key:"editorComponent",ref:g},null,512),(0,i._)("div",f,[(0,i.Wm)(o,{size:"large",type:"info",onClick:C},{default:(0,i.w5)(()=>[(0,i.Uk)((0,i.zw)((0,i.SU)(h)("confirm")),1)]),_:1})]),(0,i._)("input",{class:"hide-input",ref_key:"noneEditorElement",ref:S},null,512),(0,i.Wm)(c,{visible:y.value,"onUpdate:visible":t[0]||(t[0]=e=>y.value=e),title:(0,i.SU)(h)("tips"),content:(0,i.SU)(h)("confirmSegmentContent"),okText:(0,i.SU)(h)("confirm"),cancelText:(0,i.SU)(h)("cancel"),onOk:E},null,8,["visible","title","content","okText","cancelText"]),(0,i.Wm)(c,{visible:b.value.visible,"onUpdate:visible":t[1]||(t[1]=e=>b.value.visible=e),title:(0,i.SU)(h)("tips"),content:b.value.content,okText:(0,i.SU)(h)("confirm"),cancelText:(0,i.SU)(h)("cancel"),noCancelBtn:!0,onOk:U},null,8,["visible","title","content","okText","cancelText"]),(0,i.Wm)(r,{visible:l.value,"onUpdate:visible":t[2]||(t[2]=e=>l.value=e)},{default:(0,i.w5)(()=>[(0,i._)("div",m,[(0,i._)("div",p,[(0,i.Wm)((0,i.SU)(u.vG))])])]),_:1},8,["visible"])],64)}}}),b=y}}]);