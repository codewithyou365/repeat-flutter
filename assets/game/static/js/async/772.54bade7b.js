"use strict";(self.webpackChunktyping=self.webpackChunktyping||[]).push([["772"],{702:function(t,e,s){s.d(e,{Z:()=>_});var r=s("881"),i=s("94"),n=s("894"),a=s("755"),o=s("238"),h=s("575"),l=s("462"),u=s("480"),d=s("834");let c=(0,r.aZ)({__name:"editor",props:{type:{type:String,required:!0},save:{type:Function,required:!0}},setup(t,e){let{expose:s}=e,c=(0,i.oR)(),_=null,N=(0,r.iH)(null);return h.KD.defineEx("w","w",function(){var e;console.log("test: w"),null===(e=t.save)||void 0===e||e.call(t)}),h.KD.defineEx("x","x",function(){var e;console.log("test: x"),null===(e=t.save)||void 0===e||e.call(t)}),h.KD.defineEx("wq","wq",function(){var e;console.log("test: wq"),null===(e=t.save)||void 0===e||e.call(t)}),(0,r.bv)(()=>{if(N.value){let e=[n.Xy,(0,u._)()];"json"===t.type&&e.push((0,l.AV)()),"dark"===c.getters.currentTheme&&e.push(o.vk),c.getters.currentEnableVim&&(e.push((0,h.dV)()),e.push(d.Q)),(_=new a.tk({doc:"",extensions:e,parent:N.value})).focus()}}),s({getEditorView:()=>_,focus:()=>null==_?void 0:_.focus()}),(t,e)=>((0,r.wg)(),(0,r.iD)("div",{ref_key:"codemirrorParent",ref:N},null,512))}}),_=c},494:function(t,e,s){s.d(e,{Z:()=>u});var r=s("881"),i=s("946"),n=s("94"),a=s("13"),o=s("687");let h="18px",l=(0,r.aZ)({__name:"reconnect",setup(t){let e=(0,n.oR)(),{t:s}=(0,i.QT)(),l=t=>{let s=t===o.wJ.CONNECT_FINISH;e.dispatch("updateWsConnected",s)};(0,r.bv)(()=>{l(o.Lp.status),(0,a.$x)().on(a.B_.WsStatus,t=>{l(t)})}),(0,r.Jd)(()=>{(0,a.$x)().off(a.B_.WsStatus)});let u=(0,r.Fl)(()=>({height:h})),d=(0,r.Fl)(()=>({margin:"0",color:"#00488d",height:h,borderColor:"transparent",backgroundImage:"var(--nut-progress-inner-background-color, linear-gradient(135deg, var(--nut-primary-color, #fa2c19) 0%, var(--nut-primary-color-end, #fa6419) 100%))"})),c=(0,r.Fl)(()=>({height:h,animation:"2s ease-in-out infinite progressActive",position:"absolute"}));return(t,i)=>{let n=(0,r.up)("nut-divider");return(0,r.SU)(e).getters.currentWsConnected?((0,r.wg)(),(0,r.iD)("div",{key:1,style:(0,r.j5)(u.value)},null,4)):((0,r.wg)(),(0,r.j4)(n,{key:0,style:(0,r.j5)(d.value)},{default:(0,r.w5)(()=>[(0,r.Uk)((0,r.zw)((0,r.SU)(s)("reconnect"))+" ",1),(0,r._)("div",{style:(0,r.j5)(c.value)},null,4)]),_:1},8,["style"]))}}}),u=l},687:function(t,e,s){s.d(e,{HM:function(){return h},HQ:function(){return i},Lp:function(){return g},cf:function(){return o},wJ:function(){return d}});var r=s(438);let i=`ws://${window.location.hostname}:${window.location.port}`,n={REQUEST:0,RESPONSE:1},a={age:"age"};class o{static fromJson(t){return new o({path:t.path??"",headers:t.headers||new Map,data:t.data??""})}constructor({path:t="",headers:e=new Map,data:s=""}={}){(0,r._)(this,"path",void 0),(0,r._)(this,"headers",void 0),(0,r._)(this,"data",void 0),this.path=t,this.headers=e,this.data=s}}class h{static fromJson(t){return new h({headers:t.headers||new Map,data:t.data??"",error:t.error??"",status:t.status??200})}constructor({headers:t=new Map,data:e="",error:s="",status:i=200}={}){(0,r._)(this,"headers",void 0),(0,r._)(this,"data",void 0),(0,r._)(this,"error",void 0),(0,r._)(this,"status",void 0),this.headers=t,this.data=e,this.error=s,this.status=i}}class l{static fromJson(t){return new l({type:t.type,id:t.id||0,age:t.age||0,request:t.request?o.fromJson(t.request):null,response:t.response?h.fromJson(t.response):null})}constructor({type:t=n.REQUEST,id:e=0,age:s=0,request:i=null,response:a=null}={}){(0,r._)(this,"type",void 0),(0,r._)(this,"id",void 0),(0,r._)(this,"age",void 0),(0,r._)(this,"request",void 0),(0,r._)(this,"response",void 0),this.type=t,this.id=e,this.age=s,this.request=i,this.response=a}}class u{receive(t){if(t.age!==this.age){console.log(`[ws] ignoring message - age mismatch: ${t.age} vs ${this.age}`);return}let e=this.sendId2Res.get(t.id);if(e){let s=new Map;s.set(a.age,`${this.age}`),t.response.headers=s,e.resolve(t.response),this.sendId2Res.delete(t.id)}this.sendId2Log.get(t.id)&&(console.log("[ws] recv :",t),this.sendId2Log.delete(t.id))}async send(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.sendId++;let s=this.sendId,r=this.age,i=new l({id:s,age:r,type:n.REQUEST,request:t});e&&console.log("[ws] send :",i),this.webSocket.send(JSON.stringify(i));let o=this._createCompleter();this.sendId2Res.set(s,o),this.sendId2Log.set(s,e);let u=setTimeout(()=>{if(this.sendId2Res.delete(s)){this.sendId2Log.delete(s);let t=new Map;t.set(a.age,`${r}`),o.resolve(new h({headers:t,error:"timeout",status:504}))}},1e4);try{return await o.promise}finally{clearTimeout(u),this.sendId2Res.delete(s),this.sendId2Log.delete(s)}}_createCompleter(){let t,e;return{promise:new Promise((s,r)=>{t=s,e=r}),resolve:t,reject:e}}constructor(t,e){(0,r._)(this,"sendId",void 0),(0,r._)(this,"sendId2Res",void 0),(0,r._)(this,"sendId2Log",void 0),(0,r._)(this,"webSocket",void 0),(0,r._)(this,"age",void 0),this.sendId=0,this.sendId2Res=new Map,this.sendId2Log=new Map,this.webSocket=t,this.age=e}}let d={INIT:0,CONNECT_START:1,CONNECT_FAILED:2,CONNECT_FINISH:3,CONNECT_CLOSE:4,STOP_START:5,STOP_FINISH:6,STOP_FOR_RECONNECT_START:7,STOP_FOR_RECONNECT_FINISH:8},c=new Map([[0,"INIT"],[1,"CONNECT_START"],[2,"CONNECT_FAILED"],[3,"CONNECT_FINISH"],[4,"CONNECT_CLOSE"],[5,"STOP_START"],[6,"STOP_FINISH"],[7,"STOP_FOR_RECONNECT_START"],[8,"STOP_FOR_RECONNECT_FINISH"]]),_=new Map;function N(t,e,s){let r=new Map;for(let t of s)r.set(t,!0);_.set(t,{to:t,incAge:e,from:r})}N(d.INIT,!1,[]),N(d.CONNECT_START,!0,[d.INIT,d.STOP_FOR_RECONNECT_FINISH,d.CONNECT_CLOSE]),N(d.CONNECT_FAILED,!1,[d.CONNECT_START,d.CONNECT_FINISH]),N(d.CONNECT_FINISH,!1,[d.CONNECT_START]),N(d.CONNECT_CLOSE,!0,[d.CONNECT_FINISH]),N(d.STOP_START,!0,[d.CONNECT_FAILED,d.CONNECT_FINISH]),N(d.STOP_FINISH,!0,[d.STOP_START]),N(d.STOP_FOR_RECONNECT_START,!0,[d.CONNECT_FAILED,d.CONNECT_FINISH]),N(d.STOP_FOR_RECONNECT_FINISH,!0,[d.STOP_FOR_RECONNECT_START]);class T{constructor(){(0,r._)(this,"url",""),(0,r._)(this,"statusChange",()=>{}),(0,r._)(this,"heartSender",async()=>new h({status:200})),(0,r._)(this,"reason","")}}let g=new class t{async _loopHeart(){this.heart&&clearTimeout(this.heart);let t=-1;try{let e=await this.heartSender();t=parseInt(e.headers.get(a.age)??"-1"),200===e.status&&""===e.error?this.heart=setTimeout(()=>{this._loopHeart()},2e3):t===this.age&&this.stop(!0,"heart error:"+e.error)}catch(e){t===this.age&&this.stop(!0,"heart exception")}}async send(t){return this.node?await this.node.send(t):null}start(t,e,s){if(this.status!==d.INIT&&this.status!==d.CONNECT_CLOSE&&this.status!==d.STOP_FOR_RECONNECT_FINISH)return this.logger(`[ws] start: status error :${c.get(this.status)}`),!1;{let r=new T;return r.url=t,r.statusChange=e,r.heartSender=s,this.setStatus(d.CONNECT_START,r),!0}}stop(t,e){if(this.status!=d.CONNECT_FAILED&&this.status!=d.CONNECT_FINISH)return this.logger(`[ws] stop: status error :${c.get(this.status)} ${e}`),!1;{let s=new T;return s.reason=e,t?this.setStatus(d.STOP_FOR_RECONNECT_START,s):this.setStatus(d.STOP_START,s),!0}}_close(){this.node.webSocket.close()}_start(t,e,s){this.url=t,this.statusChange=e,this.heartSender=s;let r=new WebSocket(t);this.node=new u(r,this.age),r.onmessage=async t=>{if(this.status===d.CONNECT_FINISH)try{let e=t.data,s=l.fromJson(JSON.parse(e));if(s.type===n.RESPONSE){if(s.age!==this.age)return;this.node.receive(s)}else s.type===n.REQUEST?(console.log("[ws] recv :",s),await this._responseHandler(this.controllers,s,r)):(console.log("[ws] recv :",s),this.logger(`Unknown message type: ${s.type}`))}catch(t){this.logger(`Error handling WebSocket message: ${t}`)}},r.onclose=t=>{this.status===d.CONNECT_FINISH?this.setStatus(d.CONNECT_CLOSE,null):this.status===d.STOP_START?this.setStatus(d.STOP_FINISH,null):this.status===d.STOP_FOR_RECONNECT_START?this.setStatus(d.STOP_FOR_RECONNECT_FINISH,null):this.logger(`[ws] socket.onclose: status error :${c.get(this.status)}`)},r.onerror=t=>{this.status==d.CONNECT_START||this.status==d.CONNECT_FINISH?this.setStatus(d.CONNECT_FAILED,null):this.logger(`[ws] socket.onerror: status error :${c.get(this.status)}`)},r.onopen=()=>{this.status==d.CONNECT_START?this.setStatus(d.CONNECT_FINISH,null):this.logger(`[ws] socket.onopen: status error :${c.get(this.status)}`)}}setStatus(t,e){let s=_.get(t);if(void 0===s)throw Error(`Unknown status: ${t}`);if(!s.from.get(this.status)){this.logger(`[ws] status error : cant from ${c.get(this.status)} to ${c.get(t)} ${null==e?void 0:e.reason}`);return}switch(s.incAge&&this.age++,this.logger(`[ws] status from ${c.get(this.status)} to ${c.get(t)} ${null==e?void 0:e.reason}`),this.status=t,t){case d.CONNECT_START:this._start(e.url,e.statusChange,e.heartSender);break;case d.CONNECT_FAILED:this.stop(!0,"connect failed");break;case d.CONNECT_FINISH:this._loopHeart();break;case d.STOP_FOR_RECONNECT_START:case d.STOP_START:this._close();break;case d.STOP_FINISH:case d.STOP_FOR_RECONNECT_FINISH:case d.CONNECT_CLOSE:this.heart&&clearTimeout(this.heart),this.retry&&clearTimeout(this.retry),(t===d.STOP_FOR_RECONNECT_FINISH||t===d.CONNECT_CLOSE)&&(this.retry=setTimeout(()=>{this.start(this.url,this.statusChange,this.heartSender)},1e3))}this.statusChange(this.status)}async _responseHandler(t,e,s){let r;let i=e.request,a=i&&t.get(i.path);if(a)try{r=await a(i)||new h({status:501})}catch(e){let t;r=new h({status:500,error:t=e instanceof Error?e.message:String(e)})}else r=new h({status:404});let o=new l({id:e.id,type:n.RESPONSE,response:r});s.send(JSON.stringify(o))}constructor(t=console.log){(0,r._)(this,"logger",void 0),(0,r._)(this,"age",0),(0,r._)(this,"node",void 0),(0,r._)(this,"status",d.INIT),(0,r._)(this,"url",""),(0,r._)(this,"retry",null),(0,r._)(this,"statusChange",()=>{}),(0,r._)(this,"controllers",void 0),(0,r._)(this,"heart",null),(0,r._)(this,"heartSender",async()=>new h({status:200})),this.logger=t,this.node=null,this.controllers=new Map}}},151:function(t,e,s){s.d(e,{ZQ:function(){return l},_q:function(){return h},bY:function(){return o},ot:function(){return a},y$:function(){return n}});var r,i=s(438);let n={kick:"/api/kick",refreshGame:"/api/refreshGame",heart:"/api/heart",loginOrRegister:"/api/loginOrRegister",entryGame:"/api/entryGame",gameUserHistory:"/api/gameUserHistory",submit:"/api/submit",getEditStatus:"/api/getEditStatus",getSegmentContent:"/api/getSegmentContent",setSegmentContent:"/api/setSegmentContent"};class a{static from(t){let e=new a;return e.list=t.list,e.tips=t.tips,e}constructor(){(0,i._)(this,"list",void 0),(0,i._)(this,"tips",void 0),this.list=[],this.tips=[]}}class o{static from(t){let e=new o;return e.gameId=t.gameId||0,e.prevId=t.prevId||0,e.input=t.input||"",e}constructor(){(0,i._)(this,"gameId",void 0),(0,i._)(this,"prevId",void 0),(0,i._)(this,"input",void 0),this.gameId=0,this.prevId=0,this.input=""}}var h=((r={})[r.word=0]="word",r[r.single=1]="single",r[r.all=2]="all",r);class l{static from(t){let e=new l;return e.content=t.content||0,e}constructor(){(0,i._)(this,"content",void 0),this.content=""}}}}]);