"use strict";(self.webpackChunktyping=self.webpackChunktyping||[]).push([["74"],{768:function(e,t,s){s.r(t),s.d(t,{default:()=>h});var a=s("881"),i=s("946"),n=s("687"),r=s("151"),o=s("572");let l={class:"form-container"},u=(0,a.aZ)({__name:"game_score_minus",setup(e){let t=(0,a.iH)(!1),s=(0,a.iH)(""),{t:u}=(0,i.QT)(),h=(0,a.iH)({customReason:!1,gameType:2,reason:"watchTv",score:10}),c=(0,a.iH)(!1),d=(0,a.iH)([]),T=(0,a.iH)(!1),_=(0,a.iH)([]),g=[{text:u("watchTv"),value:"watchTv"},{text:u("changeCurrency"),value:"changeCurrency"},{text:u("playGame"),value:"playGame"},{text:u("buyGame"),value:"buyGame"},{text:u("buyItem"),value:"buyItem"},{text:u("purchaseSkin"),value:"purchaseSkin"},{text:u("unlockFeature"),value:"unlockFeature"}],N=(0,a.Fl)(()=>{let e=C.value.find(e=>e.value===h.value.gameType);return e?e.text:""}),S=(0,a.Fl)(()=>{let e=g.find(e=>e.value===h.value.reason);return e?e.text:""}),p=(0,a.iH)("watchTv");(0,a.YP)(()=>h.value.customReason,e=>{e?(p.value=h.value.reason,h.value.reason=""):h.value.reason=p.value});let v=(0,a.iH)({});(0,a.Fl)(()=>v.value[h.value.gameType]??0);let C=(0,a.Fl)(()=>[{text:u("gameTypeBlankItRight")+` (${v.value[2]??0})`,value:2}]);(0,a.bv)(async()=>{let e=new n.cf({path:r.y$.gameUserScore}),a=await n.Lp.node.send(e);a.error?(t.value=!0,s.value=u(a.error)):v.value=a.data.reduce((e,t)=>(e[t.gameType]=t.score,e),{})});let m=()=>{d.value=[h.value.gameType],c.value=!0},I=()=>{_.value=[h.value.reason],T.value=!0},O=async()=>{let e=parseInt(h.value.score,10);if(isNaN(e)||e<=0){t.value=!0,s.value=u("scoreMustBePositive");return}let a=v.value[h.value.gameType]??0;if(e>a){t.value=!0,s.value=u("scoreExceedsAvailable")+a;return}if(!h.value.reason.trim()){t.value=!0,s.value=u("reasonRequired");return}let i={customReason:h.value.customReason,gameType:h.value.gameType,reason:h.value.reason,score:e},l=new n.cf({path:r.y$.gameUserScoreMinus,data:i}),c=await n.Lp.node.send(l);c.error?(t.value=!0,s.value=u(c.error)):(o.C.success(u("operationSuccess")),history.back())},E=e=>{let{selectedValue:t,selectedOptions:s}=e;h.value.gameType=t[0],c.value=!1},w=()=>{c.value=!1},R=e=>{let{selectedValue:t,selectedOptions:s}=e;h.value.reason=t[0],T.value=!1},y=()=>{T.value=!1},f=()=>history.back();return(e,i)=>{let n=(0,a.up)("nut-navbar"),r=(0,a.up)("nut-cell"),o=(0,a.up)("nut-picker"),p=(0,a.up)("nut-popup"),v=(0,a.up)("nut-switch"),k=(0,a.up)("nut-input"),F=(0,a.up)("nut-button"),b=(0,a.up)("nut-cell-group"),H=(0,a.up)("nut-dialog");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(n,{title:(0,a.SU)(u)("shopping"),"left-show":"",onClickBack:f},null,8,["title"]),(0,a._)("div",l,[(0,a.Wm)(b,{title:""},{default:(0,a.w5)(()=>[(0,a.Wm)(r,{title:(0,a.SU)(u)("gameType"),desc:N.value,"is-link":"",onClick:m},null,8,["title","desc"]),(0,a.Wm)(p,{visible:c.value,"onUpdate:visible":i[0]||(i[0]=e=>c.value=e),position:"bottom"},{default:(0,a.w5)(()=>[(0,a.Wm)(o,{"cancel-text":(0,a.SU)(u)("cancel"),"ok-text":(0,a.SU)(u)("confirm"),"model-value":d.value,columns:C.value,title:(0,a.SU)(u)("selectGameType"),onConfirm:E,onCancel:w},null,8,["cancel-text","ok-text","model-value","columns","title"])]),_:1},8,["visible"]),(0,a.Wm)(r,{title:(0,a.SU)(u)("customReason")},{link:(0,a.w5)(()=>[(0,a.Wm)(v,{modelValue:h.value.customReason,"onUpdate:modelValue":i[1]||(i[1]=e=>h.value.customReason=e)},null,8,["modelValue"])]),_:1},8,["title"]),h.value.customReason?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(r,{key:0,title:(0,a.SU)(u)("reason"),desc:S.value,"is-link":"",onClick:I},null,8,["title","desc"])),h.value.customReason?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(p,{key:1,visible:T.value,"onUpdate:visible":i[2]||(i[2]=e=>T.value=e),position:"bottom"},{default:(0,a.w5)(()=>[(0,a.Wm)(o,{"cancel-text":(0,a.SU)(u)("cancel"),"ok-text":(0,a.SU)(u)("confirm"),"model-value":_.value,columns:g,title:(0,a.SU)(u)("selectReason"),onConfirm:R,onCancel:y},null,8,["cancel-text","ok-text","model-value","title"])]),_:1},8,["visible"])),h.value.customReason?((0,a.wg)(),(0,a.j4)(r,{key:2,title:(0,a.SU)(u)("customReasonText")},{desc:(0,a.w5)(()=>[(0,a.Wm)(k,{modelValue:h.value.reason,"onUpdate:modelValue":i[3]||(i[3]=e=>h.value.reason=e),placeholder:""},null,8,["modelValue"])]),_:1},8,["title"])):(0,a.kq)("",!0),(0,a.Wm)(r,{title:(0,a.SU)(u)("score")},{desc:(0,a.w5)(()=>[(0,a.Wm)(k,{modelValue:h.value.score,"onUpdate:modelValue":i[4]||(i[4]=e=>h.value.score=e),type:"digit",placeholder:""},null,8,["modelValue"])]),_:1},8,["title"]),(0,a.Wm)(r,{class:"submit-button"},{default:(0,a.w5)(()=>[(0,a.Wm)(F,{type:"primary",block:"",onClick:O},{default:(0,a.w5)(()=>[(0,a.Uk)((0,a.zw)((0,a.SU)(u)("submit")),1)]),_:1})]),_:1})]),_:1})]),(0,a.Wm)(H,{visible:t.value,"onUpdate:visible":i[5]||(i[5]=e=>t.value=e),title:(0,a.SU)(u)("tips"),content:s.value,okText:(0,a.SU)(u)("confirm"),"no-cancel-btn":!0,cancelText:(0,a.SU)(u)("cancel"),onOk:e.onOk,onCancel:e.onCancel},null,8,["visible","title","content","okText","cancelText","onOk","onCancel"])],64)}}}),h=u},687:function(e,t,s){s.d(t,{HM:function(){return l},HQ:function(){return i},Lp:function(){return N},cf:function(){return o},wJ:function(){return c}});var a=s(438);let i=`wss://${window.location.hostname}:${window.location.port}`,n={REQUEST:0,RESPONSE:1},r={age:"age"};class o{static fromJson(e){return new o({path:e.path??"",headers:e.headers||new Map,data:e.data??""})}constructor({path:e="",headers:t=new Map,data:s=""}={}){(0,a._)(this,"path",void 0),(0,a._)(this,"headers",void 0),(0,a._)(this,"data",void 0),this.path=e,this.headers=t,this.data=s}}class l{static fromJson(e){return new l({headers:e.headers||new Map,data:e.data??"",error:e.error??"",status:e.status??200})}constructor({headers:e=new Map,data:t="",error:s="",status:i=200}={}){(0,a._)(this,"headers",void 0),(0,a._)(this,"data",void 0),(0,a._)(this,"error",void 0),(0,a._)(this,"status",void 0),this.headers=e,this.data=t,this.error=s,this.status=i}}class u{static fromJson(e){return new u({type:e.type,id:e.id||0,age:e.age||0,request:e.request?o.fromJson(e.request):null,response:e.response?l.fromJson(e.response):null})}constructor({type:e=n.REQUEST,id:t=0,age:s=0,request:i=null,response:r=null}={}){(0,a._)(this,"type",void 0),(0,a._)(this,"id",void 0),(0,a._)(this,"age",void 0),(0,a._)(this,"request",void 0),(0,a._)(this,"response",void 0),this.type=e,this.id=t,this.age=s,this.request=i,this.response=r}}class h{receive(e){if(e.age!==this.age){console.log(`[ws] ignoring message - age mismatch: ${e.age} vs ${this.age}`);return}let t=this.sendId2Res.get(e.id);if(t){let s=new Map;s.set(r.age,`${this.age}`),e.response.headers=s,t.resolve(e.response),this.sendId2Res.delete(e.id)}this.sendId2Log.get(e.id)&&(console.log("[ws] recv :",e),this.sendId2Log.delete(e.id))}async send(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.sendId++;let s=this.sendId,a=this.age,i=new u({id:s,age:a,type:n.REQUEST,request:e});t&&console.log("[ws] send :",i),this.webSocket.send(JSON.stringify(i));let o=this._createCompleter();this.sendId2Res.set(s,o),this.sendId2Log.set(s,t);let h=setTimeout(()=>{if(this.sendId2Res.delete(s)){this.sendId2Log.delete(s);let e=new Map;e.set(r.age,`${a}`),o.resolve(new l({headers:e,error:"timeout",status:504}))}},1e4);try{return await o.promise}finally{clearTimeout(h),this.sendId2Res.delete(s),this.sendId2Log.delete(s)}}_createCompleter(){let e,t;return{promise:new Promise((s,a)=>{e=s,t=a}),resolve:e,reject:t}}constructor(e,t){(0,a._)(this,"sendId",void 0),(0,a._)(this,"sendId2Res",void 0),(0,a._)(this,"sendId2Log",void 0),(0,a._)(this,"webSocket",void 0),(0,a._)(this,"age",void 0),this.sendId=0,this.sendId2Res=new Map,this.sendId2Log=new Map,this.webSocket=e,this.age=t}}let c={INIT:0,CONNECT_START:1,CONNECT_FAILED:2,CONNECT_FINISH:3,CONNECT_CLOSE:4,STOP_START:5,STOP_FINISH:6,STOP_FOR_RECONNECT_START:7,STOP_FOR_RECONNECT_FINISH:8},d=new Map([[0,"INIT"],[1,"CONNECT_START"],[2,"CONNECT_FAILED"],[3,"CONNECT_FINISH"],[4,"CONNECT_CLOSE"],[5,"STOP_START"],[6,"STOP_FINISH"],[7,"STOP_FOR_RECONNECT_START"],[8,"STOP_FOR_RECONNECT_FINISH"]]),T=new Map;function _(e,t,s){let a=new Map;for(let e of s)a.set(e,!0);T.set(e,{to:e,incAge:t,from:a})}_(c.INIT,!1,[]),_(c.CONNECT_START,!0,[c.INIT,c.STOP_FOR_RECONNECT_FINISH,c.CONNECT_CLOSE]),_(c.CONNECT_FAILED,!1,[c.CONNECT_START,c.CONNECT_FINISH]),_(c.CONNECT_FINISH,!1,[c.CONNECT_START]),_(c.CONNECT_CLOSE,!0,[c.CONNECT_FINISH]),_(c.STOP_START,!0,[c.CONNECT_FAILED,c.CONNECT_FINISH]),_(c.STOP_FINISH,!0,[c.STOP_START]),_(c.STOP_FOR_RECONNECT_START,!0,[c.CONNECT_FAILED,c.CONNECT_FINISH]),_(c.STOP_FOR_RECONNECT_FINISH,!0,[c.STOP_FOR_RECONNECT_START]);class g{constructor(){(0,a._)(this,"url",""),(0,a._)(this,"statusChange",()=>{}),(0,a._)(this,"heartSender",async()=>new l({status:200})),(0,a._)(this,"reason","")}}let N=new class e{async _loopHeart(){this.heart&&clearTimeout(this.heart);let e=-1;try{let t=await this.heartSender();e=parseInt(t.headers.get(r.age)??"-1"),200===t.status&&""===t.error?this.heart=setTimeout(()=>{this._loopHeart()},2e3):e===this.age&&this.stop(!0,"heart error:"+t.error)}catch(t){e===this.age&&this.stop(!0,"heart exception")}}async send(e){return this.node?await this.node.send(e):null}start(e,t,s){if(this.status!==c.INIT&&this.status!==c.CONNECT_CLOSE&&this.status!==c.STOP_FOR_RECONNECT_FINISH)return this.logger(`[ws] start: status error :${d.get(this.status)}`),!1;{let a=new g;return a.url=e,a.statusChange=t,a.heartSender=s,this.setStatus(c.CONNECT_START,a),!0}}stop(e,t){if(this.status!=c.CONNECT_FAILED&&this.status!=c.CONNECT_FINISH)return this.logger(`[ws] stop: status error :${d.get(this.status)} ${t}`),!1;{let s=new g;return s.reason=t,e?this.setStatus(c.STOP_FOR_RECONNECT_START,s):this.setStatus(c.STOP_START,s),!0}}_close(){this.node.webSocket.close()}_start(e,t,s){this.url=e,this.statusChange=t,this.heartSender=s;let a=new WebSocket(e);this.node=new h(a,this.age),a.onmessage=async e=>{if(this.status===c.CONNECT_FINISH)try{let t=e.data,s=u.fromJson(JSON.parse(t));if(s.type===n.RESPONSE){if(s.age!==this.age)return;this.node.receive(s)}else s.type===n.REQUEST?(console.log("[ws] recv :",s),await this._responseHandler(this.controllers,s,a)):(console.log("[ws] recv :",s),this.logger(`Unknown message type: ${s.type}`))}catch(e){this.logger(`Error handling WebSocket message: ${e}`)}},a.onclose=e=>{this.status===c.CONNECT_FINISH?this.setStatus(c.CONNECT_CLOSE,null):this.status===c.STOP_START?this.setStatus(c.STOP_FINISH,null):this.status===c.STOP_FOR_RECONNECT_START?this.setStatus(c.STOP_FOR_RECONNECT_FINISH,null):this.logger(`[ws] socket.onclose: status error :${d.get(this.status)}`)},a.onerror=e=>{this.status==c.CONNECT_START||this.status==c.CONNECT_FINISH?this.setStatus(c.CONNECT_FAILED,null):this.logger(`[ws] socket.onerror: status error :${d.get(this.status)}`)},a.onopen=()=>{this.status==c.CONNECT_START?this.setStatus(c.CONNECT_FINISH,null):this.logger(`[ws] socket.onopen: status error :${d.get(this.status)}`)}}setStatus(e,t){let s=T.get(e);if(void 0===s)throw Error(`Unknown status: ${e}`);if(!s.from.get(this.status)){this.logger(`[ws] status error : cant from ${d.get(this.status)} to ${d.get(e)} ${null==t?void 0:t.reason}`);return}switch(s.incAge&&this.age++,this.logger(`[ws] status from ${d.get(this.status)} to ${d.get(e)} ${null==t?void 0:t.reason}`),this.status=e,e){case c.CONNECT_START:this._start(t.url,t.statusChange,t.heartSender);break;case c.CONNECT_FAILED:this.stop(!0,"connect failed");break;case c.CONNECT_FINISH:this._loopHeart();break;case c.STOP_FOR_RECONNECT_START:case c.STOP_START:this._close();break;case c.STOP_FINISH:case c.STOP_FOR_RECONNECT_FINISH:case c.CONNECT_CLOSE:this.heart&&clearTimeout(this.heart),this.retry&&clearTimeout(this.retry),(e===c.STOP_FOR_RECONNECT_FINISH||e===c.CONNECT_CLOSE)&&(this.retry=setTimeout(()=>{this.start(this.url,this.statusChange,this.heartSender)},1e3))}this.statusChange(this.status)}async _responseHandler(e,t,s){let a;let i=t.request,r=i&&e.get(i.path);if(r)try{a=await r(i)||new l({status:501})}catch(t){let e;a=new l({status:500,error:e=t instanceof Error?t.message:String(t)})}else a=new l({status:404});let o=new u({id:t.id,type:n.RESPONSE,response:a});s.send(JSON.stringify(o))}constructor(e=console.log){(0,a._)(this,"logger",void 0),(0,a._)(this,"age",0),(0,a._)(this,"node",void 0),(0,a._)(this,"status",c.INIT),(0,a._)(this,"url",""),(0,a._)(this,"retry",null),(0,a._)(this,"statusChange",()=>{}),(0,a._)(this,"controllers",void 0),(0,a._)(this,"heart",null),(0,a._)(this,"heartSender",async()=>new l({status:200})),this.logger=e,this.node=null,this.controllers=new Map}}},151:function(e,t,s){s.d(t,{D$:function(){return r},_q:function(){return u},bY:function(){return l},ot:function(){return o},y$:function(){return n}});var a,i=s(438);let n={kick:"/api/kick",refreshGame:"/api/refreshGame",heart:"/api/heart",loginOrRegister:"/api/loginOrRegister",entryGame:"/api/entryGame",gameUserHistory:"/api/gameUserHistory",gameUserScore:"/api/gameUserScore",gameUserScoreHistory:"/api/gameUserScoreHistory",gameUserScoreMinus:"/api/gameUserScoreMinus",typeGameSettings:"/api/typeGameSettings",typeVerseContent:"/api/typeVerseContent",blankItRightSettings:"/api/blankItRightSettings",blankItRightContent:"/api/blankItRightContent",blankItRightBlank:"/api/blankItRightBlank",blankItRightSubmit:"/api/blankItRightSubmit",submit:"/api/submit"};class r{static toGameType(e){switch(e){case r.TYPE.code:return r.TYPE;case r.BLANK_IT_RIGHT.code:return r.BLANK_IT_RIGHT;case r.INPUT.code:return r.INPUT;default:return r.NONE}}constructor(e,t){(0,i._)(this,"code",void 0),(0,i._)(this,"path",void 0),this.code=e,this.path=t}}(0,i._)(r,"NONE",new r(0,"")),(0,i._)(r,"TYPE",new r(1,"/game/type-game")),(0,i._)(r,"BLANK_IT_RIGHT",new r(2,"/game/blank-it-right-game")),(0,i._)(r,"INPUT",new r(3,"/game/input-game"));class o{static from(e){let t=new o;return t.list=e.list,t.tips=e.tips,t}constructor(){(0,i._)(this,"list",void 0),(0,i._)(this,"tips",void 0),this.list=[],this.tips=[]}}class l{static from(e){let t=new l;return t.gameId=e.gameId||0,t.prevId=e.prevId||0,t.input=e.input||"",t}constructor(){(0,i._)(this,"gameId",void 0),(0,i._)(this,"prevId",void 0),(0,i._)(this,"input",void 0),this.gameId=0,this.prevId=0,this.input=""}}var u=((a={})[a.word=0]="word",a[a.single=1]="single",a[a.all=2]="all",a)}}]);