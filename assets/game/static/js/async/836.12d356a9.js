"use strict";(self.webpackChunktyping=self.webpackChunktyping||[]).push([["836"],{702:function(e,t,l){l.d(t,{Z:()=>f});var n=l("881"),i=l("94"),a=l("894"),o=l("755"),s=l("238"),u=l("575"),r=l("462"),c=l("480"),v=l("834");let d=(0,n.aZ)({__name:"editor",props:{type:{type:String,required:!0},save:{type:Function,required:!0}},setup(e,t){let{expose:l}=t,d=(0,i.oR)(),f=null,p=(0,n.iH)(null);return u.KD.defineEx("w","w",function(){var t;console.log("test: w"),null===(t=e.save)||void 0===t||t.call(e)}),u.KD.defineEx("x","x",function(){var t;console.log("test: x"),null===(t=e.save)||void 0===t||t.call(e)}),u.KD.defineEx("wq","wq",function(){var t;console.log("test: wq"),null===(t=e.save)||void 0===t||t.call(e)}),(0,n.bv)(()=>{if(p.value){let t=[a.Xy,(0,c._)()];"json"===e.type&&t.push((0,r.AV)()),"dark"===d.getters.currentTheme&&t.push(s.vk),d.getters.currentEnableVim&&(t.push((0,u.dV)()),t.push(v.Q)),(f=new o.tk({doc:"",extensions:t,parent:p.value})).focus()}}),l({getEditorView:()=>f,focus:()=>null==f?void 0:f.focus()}),(e,t)=>((0,n.wg)(),(0,n.iD)("div",{ref_key:"codemirrorParent",ref:p},null,512))}}),f=d},429:function(e,t,l){l.r(t),l.d(t,{default:()=>w});var n=l("438"),i=l("881"),a=l("13"),o=l("151"),s=l("494"),u=l("987"),r=l("946"),c=l("687"),v=l("702"),d=l("556");let f={class:"container"},p={class:"overlay-body"},m={class:"overlay-content"},y=(0,i.aZ)({__name:"game-editor",setup(e){let t;let l=(0,i.iH)(!1),y=(0,i.iH)(!1),w=(0,i.iH)(new class e{constructor(){(0,n._)(this,"content",""),(0,n._)(this,"visible",!1),(0,n._)(this,"code","")}}),{t:g}=(0,r.QT)(),h=(0,d.yj)(),k=(0,d.tv)(),b=(0,i.iH)(null),_=(0,i.iH)(null);(0,i.bv)(async()=>{t=a.km.from(h.query),await S(t),(0,a.$x)().on(a.B_.RefreshGame,e=>{t=e,S(e)}),(0,a.$x)().on(a.B_.WsStatus,e=>{e===c.wJ.CONNECT_FINISH&&k.push("/loading")}),window.addEventListener("keydown",E)}),(0,i.Jd)(()=>{(0,a.$x)().off(a.B_.RefreshGame),(0,a.$x)().off(a.B_.WsStatus),window.removeEventListener("keydown",E)});let S=async e=>{try{l.value=!0;let t={gameId:e.id},n=new c.cf({path:o.y$.getSegmentContent,data:t}),i=await c.Lp.node.send(n),a=o.ZQ.from(i.data),s=JSON.stringify(JSON.parse(a.content),null,2);if(b.value){let e=b.value.getEditorView();e&&(e.dispatch({changes:{from:0,to:null==e?void 0:e.state.doc.length,insert:s}}),console.log(e.state.doc.toString()))}await k.replace({query:{id:e.id,time:e.time}})}catch(e){console.error("Failed to refresh game:",e)}finally{l.value=!1}},x=()=>{w.value.visible=!1,""===w.value.code||("editModeDisabled"===w.value.code?history.back():k.push("/home"))},E=e=>{let t=!1;y.value&&("Escape"===e.key?(y.value=!1,t=!0):"Enter"===e.key&&(y.value=!1,C())),w.value.visible&&("Escape"===e.key?(w.value.visible=!1,t=!0):"Enter"===e.key&&(w.value.visible=!1,t=!0)),t&&(0,i.Y3)(()=>{b.value&&b.value.focus()})},U=()=>{y.value=!0,(0,i.Y3)(()=>{_.value&&_.value.focus()})},C=async()=>{let e="";if(b.value){let t=b.value.getEditorView();t&&(e=t.state.doc.toString())}if(""===e){w.value.visible=!0,w.value.code="emptyContent",w.value.content=g("emptyContent");return}try{l.value=!0;let n={gameId:t.id,content:e};l.value=!0;let i=new c.cf({path:o.y$.setSegmentContent,data:n}),a=await c.Lp.node.send(i);w.value.visible=!0,w.value.code=a.error,a.error?w.value.content=g(a.error):w.value.content=g("success")}catch(e){console.error("Failed to refresh game:",e)}finally{l.value=!1}},W=()=>history.back();return(e,t)=>{let n=(0,i.up)("router-link"),a=(0,i.up)("nut-navbar"),o=(0,i.up)("nut-button"),r=(0,i.up)("nut-dialog"),c=(0,i.up)("nut-overlay");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(a,{title:(0,i.SU)(g)("edit"),"left-show":"",onClickBack:W},{right:(0,i.w5)(()=>[(0,i.Wm)(n,{to:"/settings"},{default:(0,i.w5)(()=>[(0,i.Wm)((0,i.SU)(u.pE),{width:"16px"})]),_:1})]),_:1},8,["title"]),(0,i.Wm)(s.Z),(0,i.Wm)(v.Z,{type:"json",save:U,ref_key:"editorComponent",ref:b},null,512),(0,i._)("div",f,[(0,i.Wm)(o,{size:"large",type:"info",onClick:U},{default:(0,i.w5)(()=>[(0,i.Uk)((0,i.zw)((0,i.SU)(g)("confirm")),1)]),_:1})]),(0,i._)("input",{class:"hide-input",ref_key:"noneEditorElement",ref:_},null,512),(0,i.Wm)(r,{visible:y.value,"onUpdate:visible":t[0]||(t[0]=e=>y.value=e),title:(0,i.SU)(g)("tips"),content:(0,i.SU)(g)("confirmSegmentContent"),okText:(0,i.SU)(g)("confirm"),cancelText:(0,i.SU)(g)("cancel"),onOk:C},null,8,["visible","title","content","okText","cancelText"]),(0,i.Wm)(r,{visible:w.value.visible,"onUpdate:visible":t[1]||(t[1]=e=>w.value.visible=e),title:(0,i.SU)(g)("tips"),content:w.value.content,okText:(0,i.SU)(g)("confirm"),cancelText:(0,i.SU)(g)("cancel"),noCancelBtn:!0,onOk:x},null,8,["visible","title","content","okText","cancelText"]),(0,i.Wm)(c,{visible:l.value,"onUpdate:visible":t[2]||(t[2]=e=>l.value=e)},{default:(0,i.w5)(()=>[(0,i._)("div",p,[(0,i._)("div",m,[(0,i.Wm)((0,i.SU)(u.vG))])])]),_:1},8,["visible"])],64)}}}),w=y}}]);