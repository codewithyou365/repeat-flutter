"use strict";(self.webpackChunktyping=self.webpackChunktyping||[]).push([["219"],{373:function(e,t,a){a.r(t),a.d(t,{default:()=>b});var r=a("464"),n=a("219"),l=a("687"),i=a("151"),u=a("887"),s=a("438");class o{constructor(){(0,s._)(this,"verseId",void 0),(0,s._)(this,"content",void 0),(0,s._)(this,"clearBeforeAdd",void 0),this.verseId=0,this.content="",this.clearBeforeAdd=!0}}class v{constructor(){(0,s._)(this,"verseId",void 0),(0,s._)(this,"content",void 0),this.verseId=0,this.content=""}}class c{static fromJson(e){return new c(e.score,e.answer)}constructor(e,t){(0,s._)(this,"score",void 0),(0,s._)(this,"answer",void 0),this.score=e,this.answer=t}}var d=a("759"),f=a("40"),g=a("901"),h=a("480"),w=a("118");let p={class:"container"},k={key:0,class:"container"},I={key:1,class:"container"},m={key:2,class:"container"},U=(0,r.aZ)({__name:"blank-it-right-game",setup(e){let t;let{t:a}=(0,w.QT)(),s=(0,h.oR)(),U=(0,d.yj)(),b=(0,d.tv)(),y=(0,r.iH)(!1),_=(0,r.iH)(!1),H=(0,r.iH)(!1),R=(0,r.iH)(0),S=(0,r.iH)(0),W=(0,r.iH)(""),C=(0,r.iH)(""),J=(0,r.iH)("•"),L="",B=(0,r.iH)([]),T=(0,r.iH)(),D=(0,r.iH)(1),$=(0,r.Fl)(()=>{if(R.value==s.getters.currentUserId&&1===D.value)return a("editorBlankingTip");if(R.value==s.getters.currentUserId&&2===D.value)return a("editorBlankedTip");if(R.value!=s.getters.currentUserId&&1===D.value)return a("blankingTip");else if(R.value!=s.getters.currentUserId&&2===D.value)return a("blankedTip");else if(R.value!=s.getters.currentUserId&&3===D.value)return a("answer")+C.value;return"??"}),z=(0,r.f3)("overlayVisible"),A=(0,r.f3)("tipDialogVisible"),F=(0,r.f3)("tipDialogContent"),G=async()=>{let e=new l.cf({path:i.y$.blankItRightSettings}),t=await l.Lp.node.send(e),a=u.r.fromJson(t.data).convertMap();R.value=(0,g.H)(a.get("blockItRightGameForEditorUserId")),H.value="true"===a.get("blockItRightGameForIgnorePunctuation"),_.value="true"===a.get("blockItRightGameForIgnoreCase")},M=async e=>{try{z.value=!0,await G();let t=new l.cf({path:i.y$.blankItRightContent,data:e.verseId}),n=await l.Lp.node.send(t);if(n.error){A.value=!0,F.value=a(n.error);return}if(D.value=V(n.data.step),R.value==s.getters.currentUserId){let e=JSON.parse(n.data.content);e&&(W.value=e.a??"",await (0,r.Y3)(()=>{var t,a;if(Array.isArray(e.blankItRightList)&&e.blankItRightList.length>0){let a=W.value,r=[...e.blankItRightList[0]];for(let e=0;e<a.length;e++)e>=r.length?r.push(a[e]):H.value&&/\p{P}/u.test(a[e])?r[e]=a[e]:r[e]!==a[e]&&(r[e]="•");null===(t=T.value)||void 0===t||t.initUserInput(r.join(""))}else null===(a=T.value)||void 0===a||a.initUserInput(W.value)}))}else{B.value=[];let e=n.data.content??"";for(let t=0;t<e.length;t++)"•"!==e[t]&&B.value.push(t);3===D.value?(W.value=n.data.answer??"",L=n.data.submit,C.value=n.data.answer??"",S.value=n.data.score??0,await (0,r.Y3)(()=>{var e;null===(e=T.value)||void 0===e||e.initUserInput(n.data.submit)})):W.value=e}R.value==s.getters.currentUserId&&1===D.value?(y.value=!0,J.value="•"):(R.value!=s.getters.currentUserId&&2===D.value?y.value=!1:y.value=!0,J.value=""),await b.replace({query:{verseId:e.verseId}})}catch(e){console.error("Failed to refresh game:",e)}finally{z.value=!1}};(0,r.bv)(async()=>{t=n.km.from(U.query),await M(t),(0,n.$x)().on(n.B_.RefreshGame,e=>{t=e,M(e)})}),(0,r.Jd)(()=>{(0,n.$x)().off(n.B_.RefreshGame)});let x=async()=>{var e;null===(e=T.value)||void 0===e||e.initUserInput(W.value)},q=async()=>{var e;z.value=!0;let r=new o;r.verseId=t.verseId,r.content=(null===(e=T.value)||void 0===e?void 0:e.getUserInput())??"";let n=await l.Lp.node.send(new l.cf({path:i.y$.blankItRightBlank,data:r}));if(n.error){A.value=!0,F.value=a(n.error);return}z.value=!1},Y=(0,r.iH)(!1),j=async()=>{var e,t;Y.value?null===(e=T.value)||void 0===e||e.initUserInput(L):null===(t=T.value)||void 0===t||t.initUserInput(C.value),Y.value=!Y.value},P=async()=>{var e;z.value=!0;let n=new v;n.verseId=t.verseId,n.content=(null===(e=T.value)||void 0===e?void 0:e.getUserInput())??"";let u=await l.Lp.node.send(new l.cf({path:i.y$.blankItRightSubmit,data:n}));if(u.error){A.value=!0,F.value=a(u.error);return}let s=c.fromJson(u.data);W.value=s.answer,C.value=s.answer,L=n.content,S.value=s.score,D.value=3,await (0,r.Y3)(()=>{var e;null===(e=T.value)||void 0===e||e.initUserInput(L)}),z.value=!1},V=e=>{switch(e){case"blanking":return 1;case"blanked":return 2;case"finished":return 3;default:return 0}};return(e,t)=>{let n=(0,r.up)("nut-cell"),l=(0,r.up)("nut-button"),i=(0,r.up)("nut-col"),u=(0,r.up)("nut-row");return(0,r.wg)(),(0,r.iD)("div",p,[(0,r.Wm)(n,{innerHTML:$.value.replace(/\n/g,"<br>")},null,8,["innerHTML"]),(0,r.Wm)(f.Z,{content:W.value,disabled:y.value,"ignore-case":_.value,"change-to-right-case-when-ignore-case":!1,"ignore-punctuation":H.value&&R.value==(0,r.SU)(s).getters.currentUserId,"ignore-content-indexes":B.value,"click-fill-char-when-disabled":J.value,ref_key:"typingRef",ref:T},null,8,["content","disabled","ignore-case","ignore-punctuation","ignore-content-indexes","click-fill-char-when-disabled"]),R.value==(0,r.SU)(s).getters.currentUserId&&1==D.value?((0,r.wg)(),(0,r.iD)("div",k,[(0,r.Wm)(u,{gutter:10},{default:(0,r.w5)(()=>[(0,r.Wm)(i,{span:12},{default:(0,r.w5)(()=>[(0,r.Wm)(l,{block:"",type:"info",onClick:q},{default:(0,r.w5)(()=>[(0,r.Uk)((0,r.zw)((0,r.SU)(a)("confirm")),1)]),_:1})]),_:1}),(0,r.Wm)(i,{span:12},{default:(0,r.w5)(()=>[(0,r.Wm)(l,{block:"",type:"info",onClick:x},{default:(0,r.w5)(()=>[(0,r.Uk)((0,r.zw)((0,r.SU)(a)("reset")),1)]),_:1})]),_:1})]),_:1})])):R.value!=(0,r.SU)(s).getters.currentUserId&&2==D.value?((0,r.wg)(),(0,r.iD)("div",I,[(0,r.Wm)(u,{gutter:10},{default:(0,r.w5)(()=>[(0,r.Wm)(i,{span:24},{default:(0,r.w5)(()=>[(0,r.Wm)(l,{block:"",type:"info",onClick:P},{default:(0,r.w5)(()=>[(0,r.Uk)((0,r.zw)((0,r.SU)(a)("confirm")),1)]),_:1})]),_:1})]),_:1})])):R.value!=(0,r.SU)(s).getters.currentUserId&&3==D.value?((0,r.wg)(),(0,r.iD)("div",m,[(0,r.Wm)(n,null,{default:(0,r.w5)(()=>[(0,r.Uk)((0,r.zw)((0,r.SU)(a)("score")+": +"+S.value),1)]),_:1}),(0,r.Wm)(u,{gutter:10},{default:(0,r.w5)(()=>[(0,r.Wm)(i,{span:24},{default:(0,r.w5)(()=>[(0,r.Wm)(l,{block:"",type:"info",onClick:j},{default:(0,r.w5)(()=>[(0,r.Uk)((0,r.zw)(Y.value?(0,r.SU)(a)("viewSubmit"):(0,r.SU)(a)("viewAnswer")),1)]),_:1})]),_:1})]),_:1})])):(0,r.kq)("",!0)])}}}),b=U},887:function(e,t,a){a.d(t,{r:()=>l});var r=a("438");class n{static fromJson(e){return new n(e.k,e.v)}toJson(){return{k:this.k,v:this.v}}constructor(e,t){(0,r._)(this,"k",void 0),(0,r._)(this,"v",void 0),this.k=e,this.v=t}}class l{static fromJson(e){return new l((e.list??[]).map(e=>n.fromJson(e)))}convertMap(){let e=new Map;for(let t of this.list)e.set(t.k,t.v);return e}constructor(e){(0,r._)(this,"list",void 0),this.list=e}}}}]);