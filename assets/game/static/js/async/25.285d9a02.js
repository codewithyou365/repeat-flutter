"use strict";(self.webpackChunktyping=self.webpackChunktyping||[]).push([["25"],{382:function(e,t,s){s.r(t),s.d(t,{default:()=>c});var a=s("464"),i=s("118"),r=s("687"),o=s("151"),n=s("212");let l={class:"form-container"},u=(0,a.aZ)({__name:"game_score_minus",setup(e){let t=(0,a.iH)(!1),s=(0,a.iH)(""),{t:u}=(0,i.QT)(),c=(0,a.iH)({customReason:!1,gameType:2,reason:"watchTv",score:10}),h=(0,a.iH)(!1),d=(0,a.iH)([]),S=(0,a.iH)(!1),T=(0,a.iH)([]),_=[{text:u("watchTv"),value:"watchTv"},{text:u("changeCurrency"),value:"changeCurrency"},{text:u("playGame"),value:"playGame"},{text:u("buyGame"),value:"buyGame"},{text:u("buyItem"),value:"buyItem"},{text:u("purchaseSkin"),value:"purchaseSkin"},{text:u("unlockFeature"),value:"unlockFeature"}],g=(0,a.Fl)(()=>{let e=m.value.find(e=>e.value===c.value.gameType);return e?e.text:""}),p=(0,a.Fl)(()=>{let e=_.find(e=>e.value===c.value.reason);return e?e.text:""}),N=(0,a.iH)("watchTv");(0,a.YP)(()=>c.value.customReason,e=>{e?(N.value=c.value.reason,c.value.reason=""):c.value.reason=N.value});let C=(0,a.iH)({}),m=(0,a.Fl)(()=>[{text:u("gameTypeBlankItRight")+` (${C.value[o.D$.BLANK_IT_RIGHT.code]??0})`,value:2},{text:u("gameTypeWordSlicer")+` (${C.value[o.D$.WORD_SLICER.code]??0})`,value:2}]);(0,a.bv)(async()=>{let e=new r.cf({path:o.y$.gameUserScore}),a=await r.Lp.node.send(e);a.error?(t.value=!0,s.value=u(a.error)):C.value=a.data.reduce((e,t)=>(e[t.gameType]=t.score,e),{})});let v=()=>{d.value=[c.value.gameType],h.value=!0},I=()=>{T.value=[c.value.reason],S.value=!0},O=async()=>{let e=c.value.score;if(isNaN(e)||e<=0){t.value=!0,s.value=u("scoreMustBePositive");return}let a=C.value[c.value.gameType]??0;if(e>a){t.value=!0,s.value=u("scoreExceedsAvailable")+a;return}if(!c.value.reason.trim()){t.value=!0,s.value=u("reasonRequired");return}let i={customReason:c.value.customReason,gameType:c.value.gameType,reason:c.value.reason,score:e},l=new r.cf({path:o.y$.gameUserScoreMinus,data:i}),h=await r.Lp.node.send(l);h.error?(t.value=!0,s.value=u(h.error)):(n.C.success(u("operationSuccess")),history.back())},E=e=>{let{selectedValue:t,selectedOptions:s}=e;c.value.gameType=t[0],h.value=!1},w=()=>{h.value=!1},R=e=>{let{selectedValue:t,selectedOptions:s}=e;c.value.reason=t[0],S.value=!1},y=()=>{S.value=!1},f=()=>history.back();return(e,i)=>{let r=(0,a.up)("nut-navbar"),o=(0,a.up)("nut-cell"),n=(0,a.up)("nut-picker"),N=(0,a.up)("nut-popup"),C=(0,a.up)("nut-switch"),k=(0,a.up)("nut-input"),b=(0,a.up)("nut-button"),F=(0,a.up)("nut-cell-group"),H=(0,a.up)("nut-dialog");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(r,{title:(0,a.SU)(u)("shopping"),"left-show":"",onClickBack:f},null,8,["title"]),(0,a._)("div",l,[(0,a.Wm)(F,{title:""},{default:(0,a.w5)(()=>[(0,a.Wm)(o,{title:(0,a.SU)(u)("gameType"),desc:g.value,"is-link":"",onClick:v},null,8,["title","desc"]),(0,a.Wm)(N,{visible:h.value,"onUpdate:visible":i[0]||(i[0]=e=>h.value=e),position:"bottom"},{default:(0,a.w5)(()=>[(0,a.Wm)(n,{"cancel-text":(0,a.SU)(u)("cancel"),"ok-text":(0,a.SU)(u)("confirm"),"model-value":d.value,columns:m.value,title:(0,a.SU)(u)("selectGameType"),onConfirm:E,onCancel:w},null,8,["cancel-text","ok-text","model-value","columns","title"])]),_:1},8,["visible"]),(0,a.Wm)(o,{title:(0,a.SU)(u)("customReason")},{link:(0,a.w5)(()=>[(0,a.Wm)(C,{modelValue:c.value.customReason,"onUpdate:modelValue":i[1]||(i[1]=e=>c.value.customReason=e)},null,8,["modelValue"])]),_:1},8,["title"]),c.value.customReason?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(o,{key:0,title:(0,a.SU)(u)("reason"),desc:p.value,"is-link":"",onClick:I},null,8,["title","desc"])),c.value.customReason?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(N,{key:1,visible:S.value,"onUpdate:visible":i[2]||(i[2]=e=>S.value=e),position:"bottom"},{default:(0,a.w5)(()=>[(0,a.Wm)(n,{"cancel-text":(0,a.SU)(u)("cancel"),"ok-text":(0,a.SU)(u)("confirm"),"model-value":T.value,columns:_,title:(0,a.SU)(u)("selectReason"),onConfirm:R,onCancel:y},null,8,["cancel-text","ok-text","model-value","title"])]),_:1},8,["visible"])),c.value.customReason?((0,a.wg)(),(0,a.j4)(o,{key:2,title:(0,a.SU)(u)("customReasonText")},{desc:(0,a.w5)(()=>[(0,a.Wm)(k,{modelValue:c.value.reason,"onUpdate:modelValue":i[3]||(i[3]=e=>c.value.reason=e),placeholder:""},null,8,["modelValue"])]),_:1},8,["title"])):(0,a.kq)("",!0),(0,a.Wm)(o,{title:(0,a.SU)(u)("score")},{desc:(0,a.w5)(()=>[(0,a.Wm)(k,{modelValue:c.value.score,"onUpdate:modelValue":i[4]||(i[4]=e=>c.value.score=e),type:"digit",placeholder:""},null,8,["modelValue"])]),_:1},8,["title"]),(0,a.Wm)(o,{class:"submit-button"},{default:(0,a.w5)(()=>[(0,a.Wm)(b,{type:"primary",block:"",onClick:O},{default:(0,a.w5)(()=>[(0,a.Uk)((0,a.zw)((0,a.SU)(u)("submit")),1)]),_:1})]),_:1})]),_:1})]),(0,a.Wm)(H,{visible:t.value,"onUpdate:visible":i[5]||(i[5]=e=>t.value=e),title:(0,a.SU)(u)("tips"),content:s.value,okText:(0,a.SU)(u)("confirm"),"no-cancel-btn":!0,cancelText:(0,a.SU)(u)("cancel"),onOk:e.onOk,onCancel:e.onCancel},null,8,["visible","title","content","okText","cancelText","onOk","onCancel"])],64)}}}),c=u},687:function(e,t,s){s.d(t,{HM:function(){return n},HQ:function(){return i},Lp:function(){return _},cf:function(){return o},wJ:function(){return c}});var a=s(438);let i=`wss://${window.location.hostname}:${window.location.port}`,r={REQUEST:0,RESPONSE:1};class o{static fromJson(e){return new o({path:e.path??"",headers:e.headers||new Map,data:e.data??""})}constructor({path:e="",headers:t=new Map,data:s=""}={}){(0,a._)(this,"path",void 0),(0,a._)(this,"headers",void 0),(0,a._)(this,"data",void 0),this.path=e,this.headers=t,this.data=s}}class n{static fromJson(e){return new n({headers:e.headers||new Map,data:e.data??"",error:e.error??"",status:e.status??200})}constructor({headers:e=new Map,data:t="",error:s="",status:i=200,age:r=0}={}){(0,a._)(this,"headers",void 0),(0,a._)(this,"data",void 0),(0,a._)(this,"error",void 0),(0,a._)(this,"status",void 0),(0,a._)(this,"age",void 0),this.headers=e,this.data=t,this.error=s,this.status=i,this.age=r}}class l{static fromJson(e){return new l({type:e.type,id:e.id||0,age:e.age||0,request:e.request?o.fromJson(e.request):null,response:e.response?n.fromJson(e.response):null})}constructor({type:e=r.REQUEST,id:t=0,age:s=0,request:i=null,response:o=null}={}){(0,a._)(this,"type",void 0),(0,a._)(this,"id",void 0),(0,a._)(this,"age",void 0),(0,a._)(this,"request",void 0),(0,a._)(this,"response",void 0),this.type=e,this.id=t,this.age=s,this.request=i,this.response=o}}class u{receive(e){if(e.age!==this.age){console.log(`[ws] ignoring message - age mismatch: ${e.age} vs ${this.age}`);return}let t=this.sendId2Res.get(e.id);t&&(e.response.age=this.age,t.resolve(e.response),this.sendId2Res.delete(e.id)),this.sendId2Log.get(e.id)&&(console.log("[ws] recv :",e),this.sendId2Log.delete(e.id))}async send(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.sendId++;let s=this.sendId,a=this.age,i=new l({id:s,age:a,type:r.REQUEST,request:e});t&&console.log("[ws] send :",i),this.webSocket.send(JSON.stringify(i));let o=this._createCompleter();this.sendId2Res.set(s,o),this.sendId2Log.set(s,t);let u=setTimeout(()=>{if(this.sendId2Res.delete(s)){this.sendId2Log.delete(s);let e=new Map;o.resolve(new n({headers:e,error:"timeout",status:504,age:a}))}},1e4);try{return await o.promise}finally{clearTimeout(u),this.sendId2Res.delete(s),this.sendId2Log.delete(s)}}_createCompleter(){let e,t;return{promise:new Promise((s,a)=>{e=s,t=a}),resolve:e,reject:t}}constructor(e,t){(0,a._)(this,"sendId",void 0),(0,a._)(this,"sendId2Res",void 0),(0,a._)(this,"sendId2Log",void 0),(0,a._)(this,"webSocket",void 0),(0,a._)(this,"age",void 0),this.sendId=0,this.sendId2Res=new Map,this.sendId2Log=new Map,this.webSocket=e,this.age=t}}let c={INIT:0,CONNECT_START:1,CONNECT_FAILED:2,CONNECT_FINISH:3,CONNECT_CLOSE:4,STOP_START:5,STOP_FINISH:6,STOP_FOR_RECONNECT_START:7,STOP_FOR_RECONNECT_FINISH:8},h=new Map([[0,"INIT"],[1,"CONNECT_START"],[2,"CONNECT_FAILED"],[3,"CONNECT_FINISH"],[4,"CONNECT_CLOSE"],[5,"STOP_START"],[6,"STOP_FINISH"],[7,"STOP_FOR_RECONNECT_START"],[8,"STOP_FOR_RECONNECT_FINISH"]]),d=new Map;function S(e,t,s){let a=new Map;for(let e of s)a.set(e,!0);d.set(e,{to:e,incAge:t,from:a})}S(c.INIT,!1,[]),S(c.CONNECT_START,!0,[c.INIT,c.STOP_FOR_RECONNECT_FINISH,c.CONNECT_CLOSE]),S(c.CONNECT_FAILED,!1,[c.CONNECT_START,c.CONNECT_FINISH]),S(c.CONNECT_FINISH,!1,[c.CONNECT_START]),S(c.CONNECT_CLOSE,!0,[c.CONNECT_FINISH]),S(c.STOP_START,!0,[c.CONNECT_FAILED,c.CONNECT_FINISH]),S(c.STOP_FINISH,!0,[c.STOP_START]),S(c.STOP_FOR_RECONNECT_START,!0,[c.CONNECT_FAILED,c.CONNECT_FINISH]),S(c.STOP_FOR_RECONNECT_FINISH,!0,[c.STOP_FOR_RECONNECT_START]);class T{constructor(){(0,a._)(this,"url",""),(0,a._)(this,"statusChange",()=>{}),(0,a._)(this,"heartSender",async()=>new n({status:200})),(0,a._)(this,"reason","")}}let _=new class e{async _loopHeart(){this.heart&&clearTimeout(this.heart);let e=-1;try{let t=await this.heartSender();e=t.age,200===t.status&&""===t.error?this.heart=setTimeout(()=>{this._loopHeart()},2e3):e===this.age&&this.stop(!0,"heart error:"+t.error)}catch(t){e===this.age&&this.stop(!0,"heart exception")}}async send(e){return this.node?await this.node.send(e):null}start(e,t,s){if(this.status!==c.INIT&&this.status!==c.CONNECT_CLOSE&&this.status!==c.STOP_FOR_RECONNECT_FINISH)return this.logger(`[ws] start: status error :${h.get(this.status)}`),!1;{let a=new T;return a.url=e,a.statusChange=t,a.heartSender=s,this.setStatus(c.CONNECT_START,a),!0}}stop(e,t){if(this.status!=c.CONNECT_FAILED&&this.status!=c.CONNECT_FINISH)return this.logger(`[ws] stop: status error :${h.get(this.status)} ${t}`),!1;{let s=new T;return s.reason=t,e?this.setStatus(c.STOP_FOR_RECONNECT_START,s):this.setStatus(c.STOP_START,s),!0}}_close(){this.node.webSocket.close()}_start(e,t,s){this.url=e,this.statusChange=t,this.heartSender=s;let a=new WebSocket(e);this.node=new u(a,this.age),a.onmessage=async e=>{if(this.status===c.CONNECT_FINISH)try{let t=e.data,s=l.fromJson(JSON.parse(t));if(s.type===r.RESPONSE){if(s.age!==this.age)return;this.node.receive(s)}else s.type===r.REQUEST?(console.log("[ws] recv :",s),await this._responseHandler(this.controllers,s,a)):(console.log("[ws] recv :",s),this.logger(`Unknown message type: ${s.type}`))}catch(e){this.logger(`Error handling WebSocket message: ${e}`)}},a.onclose=e=>{this.status===c.CONNECT_FINISH?this.setStatus(c.CONNECT_CLOSE,null):this.status===c.STOP_START?this.setStatus(c.STOP_FINISH,null):this.status===c.STOP_FOR_RECONNECT_START?this.setStatus(c.STOP_FOR_RECONNECT_FINISH,null):this.logger(`[ws] socket.onclose: status error :${h.get(this.status)}`)},a.onerror=e=>{this.status==c.CONNECT_START||this.status==c.CONNECT_FINISH?this.setStatus(c.CONNECT_FAILED,null):this.logger(`[ws] socket.onerror: status error :${h.get(this.status)}`)},a.onopen=()=>{this.status==c.CONNECT_START?this.setStatus(c.CONNECT_FINISH,null):this.logger(`[ws] socket.onopen: status error :${h.get(this.status)}`)}}setStatus(e,t){let s=d.get(e);if(void 0===s)throw Error(`Unknown status: ${e}`);if(!s.from.get(this.status)){this.logger(`[ws] status error : cant from ${h.get(this.status)} to ${h.get(e)} ${null==t?void 0:t.reason}`);return}switch(s.incAge&&this.age++,this.logger(`[ws] status from ${h.get(this.status)} to ${h.get(e)} ${null==t?void 0:t.reason}`),this.status=e,e){case c.CONNECT_START:this._start(t.url,t.statusChange,t.heartSender);break;case c.CONNECT_FAILED:this.stop(!0,"connect failed");break;case c.CONNECT_FINISH:this._loopHeart();break;case c.STOP_FOR_RECONNECT_START:case c.STOP_START:this._close();break;case c.STOP_FINISH:case c.STOP_FOR_RECONNECT_FINISH:case c.CONNECT_CLOSE:this.heart&&clearTimeout(this.heart),this.retry&&clearTimeout(this.retry),(e===c.STOP_FOR_RECONNECT_FINISH||e===c.CONNECT_CLOSE)&&(this.retry=setTimeout(()=>{this.start(this.url,this.statusChange,this.heartSender)},1e3))}this.statusChange(this.status)}async _responseHandler(e,t,s){let a;let i=t.request,o=i&&e.get(i.path);if(o)try{a=await o(i)||new n({status:501})}catch(t){let e;a=new n({status:500,error:e=t instanceof Error?t.message:String(t)})}else a=new n({status:404});let u=new l({id:t.id,type:r.RESPONSE,response:a});s.send(JSON.stringify(u))}constructor(e=console.log){(0,a._)(this,"logger",void 0),(0,a._)(this,"age",0),(0,a._)(this,"node",void 0),(0,a._)(this,"status",c.INIT),(0,a._)(this,"url",""),(0,a._)(this,"retry",null),(0,a._)(this,"statusChange",()=>{}),(0,a._)(this,"controllers",void 0),(0,a._)(this,"heart",null),(0,a._)(this,"heartSender",async()=>new n({status:200})),this.logger=e,this.node=null,this.controllers=new Map}}},151:function(e,t,s){s.d(t,{D$:function(){return o},_q:function(){return u},bY:function(){return l},ot:function(){return n},y$:function(){return r}});var a,i=s(438);let r={kick:"/api/kick",refreshGame:"/api/refreshGame",heart:"/api/heart",loginOrRegister:"/api/loginOrRegister",entryGame:"/api/entryGame",gameUserHistory:"/api/gameUserHistory",gameUserScore:"/api/gameUserScore",gameUserScoreHistory:"/api/gameUserScoreHistory",gameUserScoreMinus:"/api/gameUserScoreMinus",typeGameSettings:"/api/typeGameSettings",typeVerseContent:"/api/typeVerseContent",blankItRightSettings:"/api/blankItRightSettings",blankItRightContent:"/api/blankItRightContent",blankItRightBlank:"/api/blankItRightBlank",blankItRightSubmit:"/api/blankItRightSubmit",wordSlicerStatus:"/api/wordSlicerStatus",wordSlicerStatusUpdate:"/api/wordSlicerStatusUpdate",wordSlicerSelectRole:"/api/wordSlicerSelectRole",wordSlicerChooseColor:"/api/wordSlicerChooseColor",wordSlicerStartGame:"/api/wordSlicerStartGame",wordSlicerSubmit:"/api/wordSlicerSubmit",wordSlicerEdit:"/api/wordSlicerEdit",submit:"/api/submit"};class o{static toGameType(e){switch(e){case o.TYPE.code:return o.TYPE;case o.BLANK_IT_RIGHT.code:return o.BLANK_IT_RIGHT;case o.WORD_SLICER.code:return o.WORD_SLICER;case o.INPUT.code:return o.INPUT;default:return o.NONE}}constructor(e,t){(0,i._)(this,"code",void 0),(0,i._)(this,"path",void 0),this.code=e,this.path=t}}(0,i._)(o,"NONE",new o(0,"")),(0,i._)(o,"TYPE",new o(1,"/game/type-game")),(0,i._)(o,"BLANK_IT_RIGHT",new o(2,"/game/blank-it-right-game")),(0,i._)(o,"WORD_SLICER",new o(3,"/game/word-slicer-game")),(0,i._)(o,"INPUT",new o(4,"/game/input-game"));class n{static from(e){let t=new n;return t.list=e.list,t.tips=e.tips,t}constructor(){(0,i._)(this,"list",void 0),(0,i._)(this,"tips",void 0),this.list=[],this.tips=[]}}class l{static from(e){let t=new l;return t.gameId=e.gameId||0,t.prevId=e.prevId||0,t.input=e.input||"",t}constructor(){(0,i._)(this,"gameId",void 0),(0,i._)(this,"prevId",void 0),(0,i._)(this,"input",void 0),this.gameId=0,this.prevId=0,this.input=""}}var u=((a={})[a.word=0]="word",a[a.single=1]="single",a[a.all=2]="all",a)}}]);