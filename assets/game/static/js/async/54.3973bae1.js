"use strict";(self.webpackChunktyping=self.webpackChunktyping||[]).push([["54"],{40:function(e,t,s){s.d(t,{Z:()=>o});var a=s("464");let n={class:"typing-line"},i=["data-index","onClick","onPointerover","onPointerdown"],l=["disabled"],r=(0,a.aZ)({__name:"typing",props:{disabled:{type:Boolean},content:{},clickFillCharWhenDisabled:{default:""},ignoreContentIndexes:{},ignoreCase:{type:Boolean},changeToRightCaseWhenIgnoreCase:{type:Boolean},ignorePunctuation:{type:Boolean},touchColor:{default:""}},setup(e,t){let{expose:s}=t,r=(0,a.iH)({}),o=(0,a.iH)(""),u=(0,a.iH)(""),h=(0,a.iH)(null),c=(0,a.iH)(null),d=(0,a.iH)([]),g=(0,a.iH)(0),v=(0,a.iH)(0),p=(0,a.iH)(0),C=(0,a.Fl)(()=>e.content?e.content.split(""):[]),_=(0,a.Fl)(()=>/[\u4e00-\u9fff\u3040-\u309f\u30a0-\u30ff]/.test(e.content)),S=(0,a.Fl)(()=>e.disabled),T=(0,a.Fl)(()=>{let t=[];if(_.value)e.content.split("").forEach((e,s)=>{t.push({type:" "===e?"space":"char",char:e,index:s})});else{let s=[];e.content.split("").forEach((e,a)=>{" "===e?(s.length&&(t.push({type:"word",chars:s}),s=[]),t.push({type:"space",char:e,index:a})):s.push({char:e,index:a})}),s.length&&t.push({type:"word",chars:s})}return t}),N=(0,a.iH)(!1),I=(e,t)=>{e&&(d.value[t]=e)};(0,a.bv)(()=>{window.addEventListener("resize",L),f()}),(0,a.Jd)(()=>{window.removeEventListener("resize",L)});let f=async()=>{var e;await (0,a.Y3)(),null===(e=h.value)||void 0===e||e.focus(),L()},w=()=>{N.value=!0},O=e=>{N.value=!1,R(e.target.value),u.value=""};(0,a.YP)(u,e=>{if(!N.value)e.length>0&&(R(e),u.value="")});let E=(t,s)=>!!(e.ignorePunctuation&&/\p{P}/u.test(t))||void 0!==e.ignoreContentIndexes&&e.ignoreContentIndexes.includes(s),R=t=>{let s=g.value,a=o.value;for(let n of t){for(;s<e.content.length&&E(e.content[s],s);)s>=a.length&&(a+=e.content[s]),s++;s<a.length?a=a.slice(0,s)+n+a.slice(s+1):a+=n,s++}for(;s<e.content.length&&E(e.content[s],s);)s>=a.length&&(a+=e.content[s]),s++;o.value=a,g.value=s,o.value.length>e.content.length&&(o.value=o.value.slice(0,e.content.length)),g.value>e.content.length&&(g.value=e.content.length)},m=(t,s)=>{if(S.value&&(1===e.clickFillCharWhenDisabled.length||e.touchColor)){if("end"===s){p.value=null;return}let e=t.touches[0],a=e.clientX,n=e.clientY,i=document.elementFromPoint(a,n);if(null==i?void 0:i.classList.contains("typing-char")){let e=Number(i.dataset.index);!Number.isNaN(e)&&e!==p.value&&(y(null,e),p.value=e)}else p.value=null;"move"===s&&t.preventDefault()}},y=(t,s)=>{if(S.value&&(null==t||1===t.buttons)){if(1===e.clickFillCharWhenDisabled.length){u.value="";if(s>=0&&s<o.value.length&&s<e.content.length){if(E(e.content[s],s))return;let t=e.clickFillCharWhenDisabled;o.value[s]===e.clickFillCharWhenDisabled&&(t=e.content[s]),o.value=o.value.slice(0,s)+t+o.value.slice(s+1)}}else if(e.touchColor){if(E(e.content[s],s))return;r.value[s]?delete r.value[s]:r.value[s]=e.touchColor}return}},F=e=>{if(!S.value)g.value=Math.min(e,o.value.length),u.value="",L(),f()},H=()=>{g.value<v.value&&(o.value=e.content.slice(0,v.value),g.value=v.value)},k=t=>{if(!N.value){if("Backspace"===t.key){let s=g.value;if(g.value===o.value.length||E(e.content[s],s)){for(s=g.value;E(e.content[s],s)&&s<o.value.length;)s++;if(s===o.value.length&&(o.value=o.value.slice(0,g.value),g.value=o.value.length),g.value===o.value.length&&g.value>0)for(o.value=o.value.slice(0,g.value-1)+o.value.slice(g.value),g.value--;E(e.content[g.value],g.value)&&(o.value=o.value.slice(0,g.value-1)+o.value.slice(g.value),g.value--,0!=g.value););H(),L()}else{for(s++;E(e.content[s],s)&&s<o.value.length;)s++;s===o.value.length&&(o.value=o.value.slice(0,g.value),g.value=o.value.length)}t.preventDefault()}else if("ArrowLeft"===t.key){if(g.value>0){for(g.value--;E(e.content[g.value],g.value);)g.value--;L()}t.preventDefault()}else if("ArrowRight"===t.key){if(g.value<o.value.length){for(g.value++;E(e.content[g.value],g.value);)g.value++;L()}t.preventDefault()}}},P=e=>{let t=C.value[e];return e>=o.value.length?" "===t?"⎵":E(t,e)?t:"":" "===o.value[e]?"⎵":o.value[e]},b=e=>{let t=C.value[e],s=r.value[e];if(s){let a=s;if(-1!=s.indexOf(",")){let e=s.split(",");s=e[0],a=e[1]}else E(t,e)&&(a="#999");return{color:s,borderBottomColor:a,opacity:1}}return{}},A=t=>{let s=[],a=E(C.value[t],t);if(t>=o.value.length)a?s.push("pending-ignore"):s.push("pending");else{let n=o.value[t],i=C.value[t],l=n===i;e.ignoreCase&&(l=n.toLowerCase()===i.toLowerCase()),e.ignoreCase&&l&&n!==i&&e.changeToRightCaseWhenIgnoreCase&&(o.value=o.value.slice(0,t)+i+o.value.slice(t+1)),a&&l?s.push("ignore-correct"):l?s.push("correct"):s.push("wrong")}return t===g.value&&t<C.value.length&&s.push("flashing"),s},L=()=>{if(!h.value||!c.value||!d.value.length)return;let t=g.value,s=t<e.content.length?t:e.content.length-1,a=d.value[s];if(a){let e=a.getBoundingClientRect(),t=c.value.getBoundingClientRect();h.value.style.left=`${e.left-t.left}px`,h.value.style.top=`${e.top-t.top}px`,h.value.style.width=`${e.width}px`,h.value.style.height=`${e.height}px`,h.value.style.fontSize=getComputedStyle(a).fontSize,h.value.style.lineHeight=getComputedStyle(a).lineHeight}};return(0,a.YP)(()=>e.content,async()=>{var t;for(o.value="",g.value=0,d.value=Array(e.content.length),await (0,a.Y3)(),v.value=0;E(e.content[v.value],v.value);)v.value++;H(),L(),null===(t=h.value)||void 0===t||t.focus()}),(0,a.YP)([o,T],async()=>{await (0,a.Y3)(),L()}),s({initUserInput(e){o.value=e,g.value=e.length,(0,a.Y3)(L)},initContentIndexToColor(e){r.value=e},getUserInput:()=>o.value,getContentIndexToColor:()=>r.value}),(e,t)=>((0,a.wg)(),(0,a.iD)("label",null,[(0,a._)("div",{class:"typing",ref_key:"containerRef",ref:c,onClick:f},[(0,a._)("div",n,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(T.value,(e,s)=>((0,a.wg)(),(0,a.iD)(a.HY,{key:s},["word"===e.type?((0,a.wg)(),(0,a.iD)("span",{key:0,class:"word",onTouchstart:t[0]||(t[0]=e=>m(e,"start")),onTouchmove:t[1]||(t[1]=e=>m(e,"move")),onTouchend:t[2]||(t[2]=e=>m(e,"end"))},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.chars,(e,t)=>((0,a.wg)(),(0,a.iD)("span",{key:t,class:(0,a.C_)(["typing-char",A(e.index)]),"data-index":e.index,style:(0,a.j5)(b(e.index)),ref_for:!0,ref:t=>I(t,e.index),onClick:t=>F(e.index),onPointerover:t=>y(t,e.index),onPointerdown:t=>y(t,e.index)},(0,a.zw)(P(e.index)),47,i))),128))],32)):((0,a.wg)(),(0,a.iD)("span",{key:1,class:(0,a.C_)(["typing-char",[A(e.index),"space"===e.type?"space":""]]),ref_for:!0,ref:t=>I(t,e.index)},(0,a.zw)(P(e.index)),3))],64))),128))]),(0,a.wy)((0,a._)("input",{ref_key:"inputRef",ref:h,disabled:S.value,"onUpdate:modelValue":t[3]||(t[3]=e=>u.value=e),onCompositionstart:w,onCompositionend:O,onKeydown:k,class:"overlay-input",autocomplete:"off",spellcheck:"false"},null,40,l),[[a.nr,u.value]])],512)]))}}),o=(0,s("906").default)(r,[["__scopeId","data-v-c7547e62"]])},687:function(e,t,s){s.d(t,{HM:function(){return r},HQ:function(){return n},Lp:function(){return p},cf:function(){return l},wJ:function(){return h}});var a=s(438);let n=`wss://${window.location.hostname}:${window.location.port}`,i={REQUEST:0,RESPONSE:1};class l{static fromJson(e){return new l({path:e.path??"",headers:e.headers||new Map,data:e.data??""})}constructor({path:e="",headers:t=new Map,data:s=""}={}){(0,a._)(this,"path",void 0),(0,a._)(this,"headers",void 0),(0,a._)(this,"data",void 0),this.path=e,this.headers=t,this.data=s}}class r{static fromJson(e){return new r({headers:e.headers||new Map,data:e.data??"",error:e.error??"",status:e.status??200})}constructor({headers:e=new Map,data:t="",error:s="",status:n=200,age:i=0}={}){(0,a._)(this,"headers",void 0),(0,a._)(this,"data",void 0),(0,a._)(this,"error",void 0),(0,a._)(this,"status",void 0),(0,a._)(this,"age",void 0),this.headers=e,this.data=t,this.error=s,this.status=n,this.age=i}}class o{static fromJson(e){return new o({type:e.type,id:e.id||0,age:e.age||0,request:e.request?l.fromJson(e.request):null,response:e.response?r.fromJson(e.response):null})}constructor({type:e=i.REQUEST,id:t=0,age:s=0,request:n=null,response:l=null}={}){(0,a._)(this,"type",void 0),(0,a._)(this,"id",void 0),(0,a._)(this,"age",void 0),(0,a._)(this,"request",void 0),(0,a._)(this,"response",void 0),this.type=e,this.id=t,this.age=s,this.request=n,this.response=l}}class u{receive(e){if(e.age!==this.age){console.log(`[ws] ignoring message - age mismatch: ${e.age} vs ${this.age}`);return}let t=this.sendId2Res.get(e.id);t&&(e.response.age=this.age,t.resolve(e.response),this.sendId2Res.delete(e.id)),this.sendId2Log.get(e.id)&&(console.log("[ws] recv :",e),this.sendId2Log.delete(e.id))}async send(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.sendId++;let s=this.sendId,a=this.age,n=new o({id:s,age:a,type:i.REQUEST,request:e});t&&console.log("[ws] send :",n),this.webSocket.send(JSON.stringify(n));let l=this._createCompleter();this.sendId2Res.set(s,l),this.sendId2Log.set(s,t);let u=setTimeout(()=>{if(this.sendId2Res.delete(s)){this.sendId2Log.delete(s);let e=new Map;l.resolve(new r({headers:e,error:"timeout",status:504,age:a}))}},1e4);try{return await l.promise}finally{clearTimeout(u),this.sendId2Res.delete(s),this.sendId2Log.delete(s)}}_createCompleter(){let e,t;return{promise:new Promise((s,a)=>{e=s,t=a}),resolve:e,reject:t}}constructor(e,t){(0,a._)(this,"sendId",void 0),(0,a._)(this,"sendId2Res",void 0),(0,a._)(this,"sendId2Log",void 0),(0,a._)(this,"webSocket",void 0),(0,a._)(this,"age",void 0),this.sendId=0,this.sendId2Res=new Map,this.sendId2Log=new Map,this.webSocket=e,this.age=t}}let h={INIT:0,CONNECT_START:1,CONNECT_FAILED:2,CONNECT_FINISH:3,CONNECT_CLOSE:4,STOP_START:5,STOP_FINISH:6,STOP_FOR_RECONNECT_START:7,STOP_FOR_RECONNECT_FINISH:8},c=new Map([[0,"INIT"],[1,"CONNECT_START"],[2,"CONNECT_FAILED"],[3,"CONNECT_FINISH"],[4,"CONNECT_CLOSE"],[5,"STOP_START"],[6,"STOP_FINISH"],[7,"STOP_FOR_RECONNECT_START"],[8,"STOP_FOR_RECONNECT_FINISH"]]),d=new Map;function g(e,t,s){let a=new Map;for(let e of s)a.set(e,!0);d.set(e,{to:e,incAge:t,from:a})}g(h.INIT,!1,[]),g(h.CONNECT_START,!0,[h.INIT,h.STOP_FOR_RECONNECT_FINISH,h.CONNECT_CLOSE]),g(h.CONNECT_FAILED,!1,[h.CONNECT_START,h.CONNECT_FINISH]),g(h.CONNECT_FINISH,!1,[h.CONNECT_START]),g(h.CONNECT_CLOSE,!0,[h.CONNECT_FINISH]),g(h.STOP_START,!0,[h.CONNECT_FAILED,h.CONNECT_FINISH]),g(h.STOP_FINISH,!0,[h.STOP_START]),g(h.STOP_FOR_RECONNECT_START,!0,[h.CONNECT_FAILED,h.CONNECT_FINISH]),g(h.STOP_FOR_RECONNECT_FINISH,!0,[h.STOP_FOR_RECONNECT_START]);class v{constructor(){(0,a._)(this,"url",""),(0,a._)(this,"statusChange",()=>{}),(0,a._)(this,"heartSender",async()=>new r({status:200})),(0,a._)(this,"reason","")}}let p=new class e{async _loopHeart(){this.heart&&clearTimeout(this.heart);let e=-1;try{let t=await this.heartSender();e=t.age,200===t.status&&""===t.error?this.heart=setTimeout(()=>{this._loopHeart()},2e3):e===this.age&&this.stop(!0,"heart error:"+t.error)}catch(t){e===this.age&&this.stop(!0,"heart exception")}}async send(e){return this.node?await this.node.send(e):null}start(e,t,s){if(this.status!==h.INIT&&this.status!==h.CONNECT_CLOSE&&this.status!==h.STOP_FOR_RECONNECT_FINISH)return this.logger(`[ws] start: status error :${c.get(this.status)}`),!1;{let a=new v;return a.url=e,a.statusChange=t,a.heartSender=s,this.setStatus(h.CONNECT_START,a),!0}}stop(e,t){if(this.status!=h.CONNECT_FAILED&&this.status!=h.CONNECT_FINISH)return this.logger(`[ws] stop: status error :${c.get(this.status)} ${t}`),!1;{let s=new v;return s.reason=t,e?this.setStatus(h.STOP_FOR_RECONNECT_START,s):this.setStatus(h.STOP_START,s),!0}}_close(){this.node.webSocket.close()}_start(e,t,s){this.url=e,this.statusChange=t,this.heartSender=s;let a=new WebSocket(e);this.node=new u(a,this.age),a.onmessage=async e=>{if(this.status===h.CONNECT_FINISH)try{let t=e.data,s=o.fromJson(JSON.parse(t));if(s.type===i.RESPONSE){if(s.age!==this.age)return;this.node.receive(s)}else s.type===i.REQUEST?(console.log("[ws] recv :",s),await this._responseHandler(this.controllers,s,a)):(console.log("[ws] recv :",s),this.logger(`Unknown message type: ${s.type}`))}catch(e){this.logger(`Error handling WebSocket message: ${e}`)}},a.onclose=e=>{this.status===h.CONNECT_FINISH?this.setStatus(h.CONNECT_CLOSE,null):this.status===h.STOP_START?this.setStatus(h.STOP_FINISH,null):this.status===h.STOP_FOR_RECONNECT_START?this.setStatus(h.STOP_FOR_RECONNECT_FINISH,null):this.logger(`[ws] socket.onclose: status error :${c.get(this.status)}`)},a.onerror=e=>{this.status==h.CONNECT_START||this.status==h.CONNECT_FINISH?this.setStatus(h.CONNECT_FAILED,null):this.logger(`[ws] socket.onerror: status error :${c.get(this.status)}`)},a.onopen=()=>{this.status==h.CONNECT_START?this.setStatus(h.CONNECT_FINISH,null):this.logger(`[ws] socket.onopen: status error :${c.get(this.status)}`)}}setStatus(e,t){let s=d.get(e);if(void 0===s)throw Error(`Unknown status: ${e}`);if(!s.from.get(this.status)){this.logger(`[ws] status error : cant from ${c.get(this.status)} to ${c.get(e)} ${null==t?void 0:t.reason}`);return}switch(s.incAge&&this.age++,this.logger(`[ws] status from ${c.get(this.status)} to ${c.get(e)} ${null==t?void 0:t.reason}`),this.status=e,e){case h.CONNECT_START:this._start(t.url,t.statusChange,t.heartSender);break;case h.CONNECT_FAILED:this.stop(!0,"connect failed");break;case h.CONNECT_FINISH:this._loopHeart();break;case h.STOP_FOR_RECONNECT_START:case h.STOP_START:this._close();break;case h.STOP_FINISH:case h.STOP_FOR_RECONNECT_FINISH:case h.CONNECT_CLOSE:this.heart&&clearTimeout(this.heart),this.retry&&clearTimeout(this.retry),(e===h.STOP_FOR_RECONNECT_FINISH||e===h.CONNECT_CLOSE)&&(this.retry=setTimeout(()=>{this.start(this.url,this.statusChange,this.heartSender)},1e3))}this.statusChange(this.status)}async _responseHandler(e,t,s){let a;let n=t.request,l=n&&e.get(n.path);if(l)try{a=await l(n)||new r({status:501})}catch(t){let e;a=new r({status:500,error:e=t instanceof Error?t.message:String(t)})}else a=new r({status:404});let u=new o({id:t.id,type:i.RESPONSE,response:a});s.send(JSON.stringify(u))}constructor(e=console.log){(0,a._)(this,"logger",void 0),(0,a._)(this,"age",0),(0,a._)(this,"node",void 0),(0,a._)(this,"status",h.INIT),(0,a._)(this,"url",""),(0,a._)(this,"retry",null),(0,a._)(this,"statusChange",()=>{}),(0,a._)(this,"controllers",void 0),(0,a._)(this,"heart",null),(0,a._)(this,"heartSender",async()=>new r({status:200})),this.logger=e,this.node=null,this.controllers=new Map}}},151:function(e,t,s){s.d(t,{D$:function(){return l},_q:function(){return u},bY:function(){return o},ot:function(){return r},y$:function(){return i}});var a,n=s(438);let i={kick:"/api/kick",refreshGame:"/api/refreshGame",heart:"/api/heart",loginOrRegister:"/api/loginOrRegister",entryGame:"/api/entryGame",gameUserHistory:"/api/gameUserHistory",gameUserScore:"/api/gameUserScore",gameUserScoreHistory:"/api/gameUserScoreHistory",gameUserScoreMinus:"/api/gameUserScoreMinus",typeGameSettings:"/api/typeGameSettings",typeVerseContent:"/api/typeVerseContent",blankItRightSettings:"/api/blankItRightSettings",blankItRightContent:"/api/blankItRightContent",blankItRightBlank:"/api/blankItRightBlank",blankItRightSubmit:"/api/blankItRightSubmit",wordSlicerStatus:"/api/wordSlicerStatus",wordSlicerStatusUpdate:"/api/wordSlicerStatusUpdate",wordSlicerSelectRole:"/api/wordSlicerSelectRole",wordSlicerChooseColor:"/api/wordSlicerChooseColor",wordSlicerStartGame:"/api/wordSlicerStartGame",wordSlicerSubmit:"/api/wordSlicerSubmit",wordSlicerEdit:"/api/wordSlicerEdit",submit:"/api/submit"};class l{static toGameType(e){switch(e){case l.TYPE.code:return l.TYPE;case l.BLANK_IT_RIGHT.code:return l.BLANK_IT_RIGHT;case l.WORD_SLICER.code:return l.WORD_SLICER;case l.INPUT.code:return l.INPUT;default:return l.NONE}}constructor(e,t){(0,n._)(this,"code",void 0),(0,n._)(this,"path",void 0),this.code=e,this.path=t}}(0,n._)(l,"NONE",new l(0,"")),(0,n._)(l,"TYPE",new l(1,"/game/type-game")),(0,n._)(l,"BLANK_IT_RIGHT",new l(2,"/game/blank-it-right-game")),(0,n._)(l,"WORD_SLICER",new l(3,"/game/word-slicer-game")),(0,n._)(l,"INPUT",new l(4,"/game/input-game"));class r{static from(e){let t=new r;return t.list=e.list,t.tips=e.tips,t}constructor(){(0,n._)(this,"list",void 0),(0,n._)(this,"tips",void 0),this.list=[],this.tips=[]}}class o{static from(e){let t=new o;return t.gameId=e.gameId||0,t.prevId=e.prevId||0,t.input=e.input||"",t}constructor(){(0,n._)(this,"gameId",void 0),(0,n._)(this,"prevId",void 0),(0,n._)(this,"input",void 0),this.gameId=0,this.prevId=0,this.input=""}}var u=((a={})[a.word=0]="word",a[a.single=1]="single",a[a.all=2]="all",a)}}]);