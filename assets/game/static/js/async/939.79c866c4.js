"use strict";(self.webpackChunktyping=self.webpackChunktyping||[]).push([["939"],{283:function(t,e,s){s.r(e),s.d(e,{default:()=>c});var i=s("464"),r=s("219"),a=s("118"),n=s("480"),o=s("687");let l="18px",h=(0,i.aZ)({__name:"reconnect",setup(t){let e=(0,n.oR)(),{t:s}=(0,a.QT)(),h=t=>{let s=t===o.wJ.CONNECT_FINISH;e.dispatch("updateWsConnected",s)};(0,i.bv)(()=>{h(o.Lp.status),(0,r.$x)().on(r.B_.WsStatus,t=>{h(t)})}),(0,i.Jd)(()=>{(0,r.$x)().off(r.B_.WsStatus)});let u=(0,i.Fl)(()=>({height:l})),_=(0,i.Fl)(()=>({margin:"0",color:"#00488d",height:l,borderColor:"transparent",backgroundImage:"var(--nut-progress-inner-background-color, linear-gradient(135deg, var(--nut-primary-color, #fa2c19) 0%, var(--nut-primary-color-end, #fa6419) 100%))"})),d=(0,i.Fl)(()=>({height:l,animation:"2s ease-in-out infinite progressActive",position:"absolute"}));return(t,r)=>{let a=(0,i.up)("nut-divider");return(0,i.SU)(e).getters.currentWsConnected?((0,i.wg)(),(0,i.iD)("div",{key:1,style:(0,i.j5)(u.value)},null,4)):((0,i.wg)(),(0,i.j4)(a,{key:0,style:(0,i.j5)(_.value)},{default:(0,i.w5)(()=>[(0,i.Uk)((0,i.zw)((0,i.SU)(s)("reconnect"))+" ",1),(0,i._)("div",{style:(0,i.j5)(d.value)},null,4)]),_:1},8,["style"]))}}});var u=s("987"),_=s("759");let d={class:"overlay-body"},T={class:"overlay-content"},N=(0,i.aZ)({__name:"game",setup(t){let{t:e}=(0,a.QT)(),s=(0,i.iH)(!1);(0,i.JJ)("overlayVisible",s);let n=(0,i.iH)(!1);(0,i.JJ)("tipDialogVisible",n);let l=(0,i.iH)("");(0,i.JJ)("tipDialogContent",l);let N=(0,_.tv)();(0,i.bv)(async()=>{(0,r.$x)().on(r.B_.WsStatus,t=>{t===o.wJ.CONNECT_CLOSE&&N.push("/loading")})}),(0,i.Jd)(()=>{(0,r.$x)().off(r.B_.WsStatus)});let c=()=>{console.log("event cancel")},C=()=>{console.log("event ok")};return(t,r)=>{let a=(0,i.up)("router-link"),o=(0,i.up)("nut-navbar"),_=(0,i.up)("router-view"),N=(0,i.up)("nut-overlay"),S=(0,i.up)("nut-dialog");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(o,null,{right:(0,i.w5)(()=>[(0,i.Wm)(a,{to:"/game_score"},{default:(0,i.w5)(()=>[(0,i.Wm)((0,i.SU)(u.KM),{width:"16px"})]),_:1}),r[2]||(r[2]=(0,i._)("div",{style:{width:"10px"}},null,-1)),(0,i.Wm)(a,{to:"/settings"},{default:(0,i.w5)(()=>[(0,i.Wm)((0,i.SU)(u.pE),{width:"16px"})]),_:1})]),_:1}),(0,i.Wm)(h),(0,i.Wm)(_),(0,i.Wm)(N,{visible:s.value,"onUpdate:visible":r[0]||(r[0]=t=>s.value=t)},{default:(0,i.w5)(()=>[(0,i._)("div",d,[(0,i._)("div",T,[(0,i.Wm)((0,i.SU)(u.vG))])])]),_:1},8,["visible"]),(0,i.Wm)(S,{visible:n.value,"onUpdate:visible":r[1]||(r[1]=t=>n.value=t),title:(0,i.SU)(e)("tips"),content:l.value,okText:(0,i.SU)(e)("confirm"),"no-cancel-btn":!0,cancelText:(0,i.SU)(e)("cancel"),onOk:C,onCancel:c},null,8,["visible","title","content","okText","cancelText"])],64)}}}),c=N},687:function(t,e,s){s.d(e,{HM:function(){return o},HQ:function(){return r},Lp:function(){return c},cf:function(){return n},wJ:function(){return u}});var i=s(438);let r=`wss://${window.location.hostname}:${window.location.port}`,a={REQUEST:0,RESPONSE:1};class n{static fromJson(t){return new n({path:t.path??"",headers:t.headers||new Map,data:t.data??""})}constructor({path:t="",headers:e=new Map,data:s=""}={}){(0,i._)(this,"path",void 0),(0,i._)(this,"headers",void 0),(0,i._)(this,"data",void 0),this.path=t,this.headers=e,this.data=s}}class o{static fromJson(t){return new o({headers:t.headers||new Map,data:t.data??"",error:t.error??"",status:t.status??200})}constructor({headers:t=new Map,data:e="",error:s="",status:r=200,age:a=0}={}){(0,i._)(this,"headers",void 0),(0,i._)(this,"data",void 0),(0,i._)(this,"error",void 0),(0,i._)(this,"status",void 0),(0,i._)(this,"age",void 0),this.headers=t,this.data=e,this.error=s,this.status=r,this.age=a}}class l{static fromJson(t){return new l({type:t.type,id:t.id||0,age:t.age||0,request:t.request?n.fromJson(t.request):null,response:t.response?o.fromJson(t.response):null})}constructor({type:t=a.REQUEST,id:e=0,age:s=0,request:r=null,response:n=null}={}){(0,i._)(this,"type",void 0),(0,i._)(this,"id",void 0),(0,i._)(this,"age",void 0),(0,i._)(this,"request",void 0),(0,i._)(this,"response",void 0),this.type=t,this.id=e,this.age=s,this.request=r,this.response=n}}class h{receive(t){if(t.age!==this.age){console.log(`[ws] ignoring message - age mismatch: ${t.age} vs ${this.age}`);return}let e=this.sendId2Res.get(t.id);e&&(t.response.age=this.age,e.resolve(t.response),this.sendId2Res.delete(t.id)),this.sendId2Log.get(t.id)&&(console.log("[ws] recv :",t),this.sendId2Log.delete(t.id))}async send(t){let e=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.sendId++;let s=this.sendId,i=this.age,r=new l({id:s,age:i,type:a.REQUEST,request:t});e&&console.log("[ws] send :",r),this.webSocket.send(JSON.stringify(r));let n=this._createCompleter();this.sendId2Res.set(s,n),this.sendId2Log.set(s,e);let h=setTimeout(()=>{if(this.sendId2Res.delete(s)){this.sendId2Log.delete(s);let t=new Map;n.resolve(new o({headers:t,error:"timeout",status:504,age:i}))}},1e4);try{return await n.promise}finally{clearTimeout(h),this.sendId2Res.delete(s),this.sendId2Log.delete(s)}}_createCompleter(){let t,e;return{promise:new Promise((s,i)=>{t=s,e=i}),resolve:t,reject:e}}constructor(t,e){(0,i._)(this,"sendId",void 0),(0,i._)(this,"sendId2Res",void 0),(0,i._)(this,"sendId2Log",void 0),(0,i._)(this,"webSocket",void 0),(0,i._)(this,"age",void 0),this.sendId=0,this.sendId2Res=new Map,this.sendId2Log=new Map,this.webSocket=t,this.age=e}}let u={INIT:0,CONNECT_START:1,CONNECT_FAILED:2,CONNECT_FINISH:3,CONNECT_CLOSE:4,STOP_START:5,STOP_FINISH:6,STOP_FOR_RECONNECT_START:7,STOP_FOR_RECONNECT_FINISH:8},_=new Map([[0,"INIT"],[1,"CONNECT_START"],[2,"CONNECT_FAILED"],[3,"CONNECT_FINISH"],[4,"CONNECT_CLOSE"],[5,"STOP_START"],[6,"STOP_FINISH"],[7,"STOP_FOR_RECONNECT_START"],[8,"STOP_FOR_RECONNECT_FINISH"]]),d=new Map;function T(t,e,s){let i=new Map;for(let t of s)i.set(t,!0);d.set(t,{to:t,incAge:e,from:i})}T(u.INIT,!1,[]),T(u.CONNECT_START,!0,[u.INIT,u.STOP_FOR_RECONNECT_FINISH,u.CONNECT_CLOSE]),T(u.CONNECT_FAILED,!1,[u.CONNECT_START,u.CONNECT_FINISH]),T(u.CONNECT_FINISH,!1,[u.CONNECT_START]),T(u.CONNECT_CLOSE,!0,[u.CONNECT_FINISH]),T(u.STOP_START,!0,[u.CONNECT_FAILED,u.CONNECT_FINISH]),T(u.STOP_FINISH,!0,[u.STOP_START]),T(u.STOP_FOR_RECONNECT_START,!0,[u.CONNECT_FAILED,u.CONNECT_FINISH]),T(u.STOP_FOR_RECONNECT_FINISH,!0,[u.STOP_FOR_RECONNECT_START]);class N{constructor(){(0,i._)(this,"url",""),(0,i._)(this,"statusChange",()=>{}),(0,i._)(this,"heartSender",async()=>new o({status:200})),(0,i._)(this,"reason","")}}let c=new class t{async _loopHeart(){this.heart&&clearTimeout(this.heart);let t=-1;try{let e=await this.heartSender();t=e.age,200===e.status&&""===e.error?this.heart=setTimeout(()=>{this._loopHeart()},2e3):t===this.age&&this.stop(!0,"heart error:"+e.error)}catch(e){t===this.age&&this.stop(!0,"heart exception")}}async send(t){return this.node?await this.node.send(t):null}start(t,e,s){if(this.status!==u.INIT&&this.status!==u.CONNECT_CLOSE&&this.status!==u.STOP_FOR_RECONNECT_FINISH)return this.logger(`[ws] start: status error :${_.get(this.status)}`),!1;{let i=new N;return i.url=t,i.statusChange=e,i.heartSender=s,this.setStatus(u.CONNECT_START,i),!0}}stop(t,e){if(this.status!=u.CONNECT_FAILED&&this.status!=u.CONNECT_FINISH)return this.logger(`[ws] stop: status error :${_.get(this.status)} ${e}`),!1;{let s=new N;return s.reason=e,t?this.setStatus(u.STOP_FOR_RECONNECT_START,s):this.setStatus(u.STOP_START,s),!0}}_close(){this.node.webSocket.close()}_start(t,e,s){this.url=t,this.statusChange=e,this.heartSender=s;let i=new WebSocket(t);this.node=new h(i,this.age),i.onmessage=async t=>{if(this.status===u.CONNECT_FINISH)try{let e=t.data,s=l.fromJson(JSON.parse(e));if(s.type===a.RESPONSE){if(s.age!==this.age)return;this.node.receive(s)}else s.type===a.REQUEST?(console.log("[ws] recv :",s),await this._responseHandler(this.controllers,s,i)):(console.log("[ws] recv :",s),this.logger(`Unknown message type: ${s.type}`))}catch(t){this.logger(`Error handling WebSocket message: ${t}`)}},i.onclose=t=>{this.status===u.CONNECT_FINISH?this.setStatus(u.CONNECT_CLOSE,null):this.status===u.STOP_START?this.setStatus(u.STOP_FINISH,null):this.status===u.STOP_FOR_RECONNECT_START?this.setStatus(u.STOP_FOR_RECONNECT_FINISH,null):this.logger(`[ws] socket.onclose: status error :${_.get(this.status)}`)},i.onerror=t=>{this.status==u.CONNECT_START||this.status==u.CONNECT_FINISH?this.setStatus(u.CONNECT_FAILED,null):this.logger(`[ws] socket.onerror: status error :${_.get(this.status)}`)},i.onopen=()=>{this.status==u.CONNECT_START?this.setStatus(u.CONNECT_FINISH,null):this.logger(`[ws] socket.onopen: status error :${_.get(this.status)}`)}}setStatus(t,e){let s=d.get(t);if(void 0===s)throw Error(`Unknown status: ${t}`);if(!s.from.get(this.status)){this.logger(`[ws] status error : cant from ${_.get(this.status)} to ${_.get(t)} ${null==e?void 0:e.reason}`);return}switch(s.incAge&&this.age++,this.logger(`[ws] status from ${_.get(this.status)} to ${_.get(t)} ${null==e?void 0:e.reason}`),this.status=t,t){case u.CONNECT_START:this._start(e.url,e.statusChange,e.heartSender);break;case u.CONNECT_FAILED:this.stop(!0,"connect failed");break;case u.CONNECT_FINISH:this._loopHeart();break;case u.STOP_FOR_RECONNECT_START:case u.STOP_START:this._close();break;case u.STOP_FINISH:case u.STOP_FOR_RECONNECT_FINISH:case u.CONNECT_CLOSE:this.heart&&clearTimeout(this.heart),this.retry&&clearTimeout(this.retry),(t===u.STOP_FOR_RECONNECT_FINISH||t===u.CONNECT_CLOSE)&&(this.retry=setTimeout(()=>{this.start(this.url,this.statusChange,this.heartSender)},1e3))}this.statusChange(this.status)}async _responseHandler(t,e,s){let i;let r=e.request,n=r&&t.get(r.path);if(n)try{i=await n(r)||new o({status:501})}catch(e){let t;i=new o({status:500,error:t=e instanceof Error?e.message:String(e)})}else i=new o({status:404});let h=new l({id:e.id,type:a.RESPONSE,response:i});s.send(JSON.stringify(h))}constructor(t=console.log){(0,i._)(this,"logger",void 0),(0,i._)(this,"age",0),(0,i._)(this,"node",void 0),(0,i._)(this,"status",u.INIT),(0,i._)(this,"url",""),(0,i._)(this,"retry",null),(0,i._)(this,"statusChange",()=>{}),(0,i._)(this,"controllers",void 0),(0,i._)(this,"heart",null),(0,i._)(this,"heartSender",async()=>new o({status:200})),this.logger=t,this.node=null,this.controllers=new Map}}}}]);