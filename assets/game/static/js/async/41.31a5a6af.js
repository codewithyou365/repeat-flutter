"use strict";(self.webpackChunktyping=self.webpackChunktyping||[]).push([["41"],{702:function(t,e,l){l.d(e,{Z:()=>v});var i=l("881"),a=l("94"),n=l("894"),u=l("755"),o=l("238"),s=l("575"),r=l("462"),p=l("480"),c=l("834");let d=(0,i.aZ)({__name:"editor",props:{type:{type:String,required:!0},save:{type:Function,required:!0}},setup(t,e){let{expose:l}=e,d=(0,a.oR)(),v=null,w=(0,i.iH)(null);return s.KD.defineEx("w","w",function(){var e;console.log("test: w"),null===(e=t.save)||void 0===e||e.call(t)}),s.KD.defineEx("x","x",function(){var e;console.log("test: x"),null===(e=t.save)||void 0===e||e.call(t)}),s.KD.defineEx("wq","wq",function(){var e;console.log("test: wq"),null===(e=t.save)||void 0===e||e.call(t)}),(0,i.bv)(()=>{if(w.value){let e=[n.Xy,(0,p._)()];"json"===t.type&&e.push((0,r.AV)()),"dark"===d.getters.currentTheme&&e.push(o.vk),d.getters.currentEnableVim&&(e.push((0,s.dV)()),e.push(c.Q)),(v=new u.tk({doc:"",extensions:e,parent:w.value})).focus()}}),l({getEditorView:()=>v,focus:()=>null==v?void 0:v.focus()}),(t,e)=>((0,i.wg)(),(0,i.iD)("div",{ref_key:"codemirrorParent",ref:w},null,512))}}),v=d},325:function(t,e,l){l.r(e),l.d(e,{default:()=>D});var i=l("881"),a=l("13"),n=l("151"),u=l("702"),o=l("494"),s=l("987"),r=l("946"),p=l("687"),c=l("200"),d=l("556");let v={class:"container"},w={key:0,class:"input-hit"},f={key:1,class:"input-error"},g={key:2,class:"input"},y={key:3,class:"output-finish"},h={key:4,class:"output"},m={key:5,class:"output-error"},k={class:"container"},_={class:"overlay-body"},b={class:"overlay-content"},x=(0,i.aZ)({__name:"game",setup(t){let e;let l=(0,i.iH)(null),x=(0,i.iH)([]),D=(0,i.iH)(!1),H=(0,i.iH)(!1),{t:E}=(0,r.QT)(),q=0,C=(0,i.iH)([]),S=(0,d.yj)(),W=(0,d.tv)();(0,i.bv)(async()=>{e=a.km.from(S.query),await j(e),await z(),(0,a.$x)().on(a.B_.RefreshGame,t=>{e=t,j(t)}),(0,a.$x)().on(a.B_.WsStatus,t=>{t===p.wJ.CONNECT_FINISH&&W.push("/loading")})}),(0,i.Jd)(()=>{(0,a.$x)().off(a.B_.RefreshGame),(0,a.$x)().off(a.B_.WsStatus)});let z=async()=>{try{H.value=!0;let t=new p.cf({path:n.y$.getEditStatus}),e=await p.Lp.node.send(t);D.value=e.data}catch(t){console.error("Failed to refreshEnableEdit:",t)}finally{H.value=!1}},j=async t=>{try{H.value=!0;let e={gameId:t.id,time:t.time},i=new p.cf({path:n.y$.gameUserHistory,data:e}),a=await p.Lp.node.send(i),u=n.ot.from(a.data);if(x.value=u.list.map(t=>({input:t.input,output:t.output})),q=u.list.length?u.list[u.list.length-1].id:0,C.value=u.list.length?u.list[u.list.length-1].output:[],await W.replace({query:{id:t.id,time:t.time}}),l.value&&u.tips.length>0){let t=l.value.getEditorView();null==t||t.dispatch({changes:{from:0,to:null==t?void 0:t.state.doc.length,insert:u.tips.join(" ")}})}}catch(t){console.error("Failed to refresh game:",t)}finally{H.value=!1}},U=()=>{console.log("event cancel")},$=()=>{W.push("/home")},B=async()=>{let t,a="";l.value&&(t=l.value.getEditorView())&&(a=t.state.doc.toString()),H.value=!0;let u=new n.bY;u.gameId=e.id,u.prevId=q,u.input=a;let o=await p.Lp.node.send(new p.cf({path:n.y$.submit,data:u}));if(o.error){(0,c.vC)({title:E("tips"),content:E(o.error),noCancelBtn:!0,okText:E("confirm"),onCancel:U,onOk:$});return}let s=o.data;q=s.id,x.value.push({input:s.input,output:s.output}),C.value=s.output,await (0,i.Y3)(()=>{window.scrollTo(0,document.body.scrollHeight)});let r="";r=s.matchType===n._q.all?s.output.join(" "):"",null==t||t.dispatch({changes:{from:0,to:null==t?void 0:t.state.doc.length,insert:r}}),H.value=!1},I=(0,i.Fl)(()=>{let t=C.value.join("");return 0===t.length||-1!==t.indexOf("•")}),K=t=>{for(let e of t)if("•"===e)return!1;return!0},T=()=>history.back(),V=async()=>{await W.push({path:"/game-editor",query:{id:e.id,time:e.time}})};return(t,e)=>{let a=(0,i.up)("router-link"),n=(0,i.up)("nut-navbar"),r=(0,i.up)("nut-button"),p=(0,i.up)("dev"),c=(0,i.up)("nut-overlay");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(n,{"left-show":"",onClickBack:T},{right:(0,i.w5)(()=>[D.value?((0,i.wg)(),(0,i.j4)((0,i.SU)(s.I8),{key:0,class:"nav-bar",width:"16px",onClick:V})):(0,i.kq)("",!0),(0,i.Wm)(a,{to:"/settings"},{default:(0,i.w5)(()=>[(0,i.Wm)((0,i.SU)(s.pE),{width:"16px"})]),_:1})]),_:1}),(0,i.Wm)(o.Z),(0,i._)("div",v,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(x.value,(t,e)=>((0,i.wg)(),(0,i.iD)("div",{key:e,class:"history-item"},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.input,(e,l)=>((0,i.wg)(),(0,i.iD)("div",{key:l,class:"history-word"},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e,(e,a)=>((0,i.wg)(),(0,i.iD)("div",{key:a,class:"history-char"},["•"!==e&&t.output[l]&&t.output[l][a]&&t.output[l][a]===e?((0,i.wg)(),(0,i.iD)("span",w,(0,i.zw)(e),1)):"•"!==e?((0,i.wg)(),(0,i.iD)("span",f,(0,i.zw)(e),1)):((0,i.wg)(),(0,i.iD)("span",g,(0,i.zw)(e),1)),t.output[l]&&t.output[l][a]&&K(t.output[l])?((0,i.wg)(),(0,i.iD)("span",y,(0,i.zw)(t.output[l][a]),1)):t.output[l]&&t.output[l][a]?((0,i.wg)(),(0,i.iD)("span",h,(0,i.zw)(t.output[l][a]),1)):((0,i.wg)(),(0,i.iD)("span",m,(0,i.zw)("\xd7")))]))),128))]))),128))]))),128))]),I.value?((0,i.wg)(),(0,i.j4)(p,{key:0},{default:(0,i.w5)(()=>[(0,i.Wm)(u.Z,{type:"txt",save:B,ref_key:"editorComponent",ref:l},null,512),(0,i._)("div",k,[(0,i.Wm)(r,{size:"large",type:"info",onClick:B},{default:(0,i.w5)(()=>[(0,i.Uk)((0,i.zw)((0,i.SU)(E)("confirm")),1)]),_:1})])]),_:1})):(0,i.kq)("",!0),(0,i.Wm)(c,{visible:H.value,"onUpdate:visible":e[0]||(e[0]=t=>H.value=t)},{default:(0,i.w5)(()=>[(0,i._)("div",_,[(0,i._)("div",b,[(0,i.Wm)((0,i.SU)(s.vG))])])]),_:1},8,["visible"])],64)}}}),D=x}}]);