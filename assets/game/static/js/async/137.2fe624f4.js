"use strict";(self.webpackChunktyping=self.webpackChunktyping||[]).push([["137"],{421:function(t,e,l){l.r(e),l.d(e,{default:()=>H});var a=l("881"),i=l("13"),u=l("151"),n=l("702"),o=l("494"),s=l("987"),r=l("946"),p=l("687"),c=l("200"),d=l("556");let w={class:"container"},v={key:0,class:"input-hit"},g={key:1,class:"input-error"},h={key:2,class:"input"},y={key:3,class:"output-finish"},f={key:4,class:"output"},m={key:5,class:"output-error"},k={class:"container"},_={class:"overlay-body"},b={class:"overlay-content"},D=(0,a.aZ)({__name:"game",setup(t){let e;let l=(0,a.iH)(null),D=(0,a.iH)([]),H=(0,a.iH)(!1),C=(0,a.iH)(!1),{t:W}=(0,r.QT)(),x=0,z=(0,a.iH)([]),E=(0,d.yj)(),S=(0,d.tv)();(0,a.bv)(async()=>{e=i.km.from(E.query),await B(e),await $(),(0,i.$x)().on(i.B_.RefreshGame,t=>{e=t,B(t)}),(0,i.$x)().on(i.B_.WsStatus,t=>{t===p.wJ.CONNECT_CLOSE&&S.push("/loading")})}),(0,a.Jd)(()=>{(0,i.$x)().off(i.B_.RefreshGame),(0,i.$x)().off(i.B_.WsStatus)});let $=async()=>{try{C.value=!0;let t=new p.cf({path:u.y$.getEditStatus}),e=await p.Lp.node.send(t);H.value=e.data}catch(t){console.error("Failed to refreshEnableEdit:",t)}finally{C.value=!1}},B=async t=>{try{C.value=!0;let e={gameId:t.id,time:t.time},a=new p.cf({path:u.y$.gameUserHistory,data:e}),i=await p.Lp.node.send(a),n=u.ot.from(i.data);if(D.value=n.list.map(t=>({input:t.input,output:t.output})),x=n.list.length?n.list[n.list.length-1].id:0,z.value=n.list.length?n.list[n.list.length-1].output:[],await S.replace({query:{id:t.id,time:t.time}}),l.value&&n.tips.length>0){let t=l.value.getEditorView();null==t||t.dispatch({changes:{from:0,to:null==t?void 0:t.state.doc.length,insert:n.tips.join(" ")}})}}catch(t){console.error("Failed to refresh game:",t)}finally{C.value=!1}},U=()=>{console.log("event cancel")},Y=()=>{S.push("/home")},j=async()=>{let t,i="";l.value&&(t=l.value.getEditorView())&&(i=t.state.doc.toString()),C.value=!0;let n=new u.bY;n.gameId=e.id,n.prevId=x,n.input=i;let o=await p.Lp.node.send(new p.cf({path:u.y$.submit,data:n}));if(o.error){(0,c.vC)({title:W("tips"),content:W(o.error),noCancelBtn:!0,okText:W("confirm"),onCancel:U,onOk:Y});return}let s=o.data;x=s.id,D.value.push({input:s.input,output:s.output}),z.value=s.output,await (0,a.Y3)(()=>{window.scrollTo(0,document.body.scrollHeight)});let r="";r=s.matchType===u._q.all?s.output.join(" "):"",null==t||t.dispatch({changes:{from:0,to:null==t?void 0:t.state.doc.length,insert:r}}),C.value=!1},T=(0,a.Fl)(()=>{let t=z.value.join("");return 0===t.length||-1!==t.indexOf("•")}),q=t=>{for(let e of t)if("•"===e)return!1;return!0},L=()=>history.back();return(t,e)=>{let i=(0,a.up)("router-link"),u=(0,a.up)("nut-navbar"),r=(0,a.up)("nut-button"),p=(0,a.up)("dev"),c=(0,a.up)("nut-overlay");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(u,{"left-show":"",onClickBack:L},{right:(0,a.w5)(()=>[(0,a.Wm)(i,{to:"/settings"},{default:(0,a.w5)(()=>[(0,a.Wm)((0,a.SU)(s.pE),{width:"16px"})]),_:1})]),_:1}),(0,a.Wm)(o.Z),(0,a._)("div",w,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(D.value,(t,e)=>((0,a.wg)(),(0,a.iD)("div",{key:e,class:"history-item"},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.input,(e,l)=>((0,a.wg)(),(0,a.iD)("div",{key:l,class:"history-word"},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e,(e,i)=>((0,a.wg)(),(0,a.iD)("div",{key:i,class:"history-char"},["•"!==e&&t.output[l]&&t.output[l][i]&&t.output[l][i]===e?((0,a.wg)(),(0,a.iD)("span",v,(0,a.zw)(e),1)):"•"!==e?((0,a.wg)(),(0,a.iD)("span",g,(0,a.zw)(e),1)):((0,a.wg)(),(0,a.iD)("span",h,(0,a.zw)(e),1)),t.output[l]&&t.output[l][i]&&q(t.output[l])?((0,a.wg)(),(0,a.iD)("span",y,(0,a.zw)(t.output[l][i]),1)):t.output[l]&&t.output[l][i]?((0,a.wg)(),(0,a.iD)("span",f,(0,a.zw)(t.output[l][i]),1)):((0,a.wg)(),(0,a.iD)("span",m,(0,a.zw)("\xd7")))]))),128))]))),128))]))),128))]),T.value?((0,a.wg)(),(0,a.j4)(p,{key:0},{default:(0,a.w5)(()=>[(0,a.Wm)(n.Z,{type:"txt",save:j,ref_key:"editorComponent",ref:l},null,512),(0,a._)("div",k,[(0,a.Wm)(r,{size:"large",type:"info",onClick:j},{default:(0,a.w5)(()=>[(0,a.Uk)((0,a.zw)((0,a.SU)(W)("confirm")),1)]),_:1})])]),_:1})):(0,a.kq)("",!0),(0,a.Wm)(c,{visible:C.value,"onUpdate:visible":e[0]||(e[0]=t=>C.value=t)},{default:(0,a.w5)(()=>[(0,a._)("div",_,[(0,a._)("div",b,[(0,a.Wm)((0,a.SU)(s.vG))])])]),_:1},8,["visible"])],64)}}}),H=D}}]);