"use strict";(self.webpackChunktyping=self.webpackChunktyping||[]).push([["966"],{388:function(e,t,a){a.r(t),a.d(t,{default:()=>b});var r=a("881"),n=a("219"),l=a("687"),u=a("151"),i=a("910"),s=a("438");class v{constructor(){(0,s._)(this,"verseId",void 0),(0,s._)(this,"content",void 0),(0,s._)(this,"clearBeforeAdd",void 0),this.verseId=0,this.content="",this.clearBeforeAdd=!0}}class o{constructor(){(0,s._)(this,"verseId",void 0),(0,s._)(this,"content",void 0),this.verseId=0,this.content=""}}class d{static fromJson(e){return new d(e.score,e.answer)}constructor(e,t){(0,s._)(this,"score",void 0),(0,s._)(this,"answer",void 0),this.score=e,this.answer=t}}var c=a("556"),f=a("268"),w=a("901"),g=a("94"),p=a("946");let h={class:"container"},I={key:0,class:"container"},k={key:1,class:"container"},U={key:2,class:"container"},m=(0,r.aZ)({__name:"blank-it-right-game",setup(e){let t;let{t:a}=(0,p.QT)(),s=(0,g.oR)(),m=(0,c.yj)(),b=(0,c.tv)(),y=(0,r.iH)(!1),_=(0,r.iH)(!1),H=(0,r.iH)(!1),W=(0,r.iH)(0),S=(0,r.iH)(0),R=(0,r.iH)(""),C=(0,r.iH)(""),L=(0,r.iH)("•"),B="",T=(0,r.iH)([]),D=(0,r.iH)(),$=(0,r.iH)(1),z=(0,r.Fl)(()=>{if(W.value==s.getters.currentUserId&&1===$.value)return a("editorBlankingTip");if(W.value==s.getters.currentUserId&&2===$.value)return a("editorBlankedTip");if(W.value!=s.getters.currentUserId&&1===$.value)return a("blankingTip");else if(W.value!=s.getters.currentUserId&&2===$.value)return a("blankedTip");else if(W.value!=s.getters.currentUserId&&3===$.value)return a("answer")+C.value;return"??"}),F=(0,r.f3)("overlayVisible"),G=(0,r.f3)("tipDialogVisible"),J=(0,r.f3)("tipDialogContent"),x=async()=>{let e=new l.cf({path:u.y$.blankItRightSettings}),t=await l.Lp.node.send(e),a=i.r.fromJson(t.data).convertMap();W.value=(0,w.H)(a.get("blockItRightGameForEditorUserId")),H.value="true"===a.get("typeGameForIgnorePunctuation"),_.value="true"===a.get("typeGameForIgnoreCase")},q=async e=>{try{F.value=!0;let t=new l.cf({path:u.y$.blankItRightContent,data:e.verseId}),n=await l.Lp.node.send(t);if(n.error){G.value=!0,J.value=a(n.error);return}if($.value=j(n.data.step),W.value==s.getters.currentUserId){let e=JSON.parse(n.data.content);e&&(R.value=e.a??"",await (0,r.Y3)(()=>{var t,a;e.blankItRightList&&e.blankItRightList.length>0?null===(t=D.value)||void 0===t||t.initUserInput(e.blankItRightList[0]):null===(a=D.value)||void 0===a||a.initUserInput(R.value)}))}else{T.value=[];let e=n.data.content??"";for(let t=0;t<e.length;t++)"•"!==e[t]&&T.value.push(t);3===$.value?(R.value=n.data.answer??"",B=n.data.submit,C.value=n.data.answer??"",S.value=n.data.score??0,await (0,r.Y3)(()=>{var e;null===(e=D.value)||void 0===e||e.initUserInput(n.data.submit)})):R.value=e}W.value==s.getters.currentUserId&&1===$.value?(y.value=!0,L.value="•"):(W.value!=s.getters.currentUserId&&2===$.value?y.value=!1:y.value=!0,L.value=""),await b.replace({query:{verseId:e.verseId}})}catch(e){console.error("Failed to refresh game:",e)}finally{F.value=!1}};(0,r.bv)(async()=>{t=n.km.from(m.query),await x(),await q(t),(0,n.$x)().on(n.B_.RefreshGame,e=>{t=e,q(e)})}),(0,r.Jd)(()=>{(0,n.$x)().off(n.B_.RefreshGame)});let A=async()=>{var e;null===(e=D.value)||void 0===e||e.initUserInput(R.value)},M=async()=>{var e;F.value=!0;let r=new v;r.verseId=t.verseId,r.content=(null===(e=D.value)||void 0===e?void 0:e.getUserInput())??"";let n=await l.Lp.node.send(new l.cf({path:u.y$.blankItRightBlank,data:r}));if(n.error){G.value=!0,J.value=a(n.error);return}F.value=!1},Y=(0,r.iH)(!1),V=async()=>{var e,t;Y.value?null===(e=D.value)||void 0===e||e.initUserInput(B):null===(t=D.value)||void 0===t||t.initUserInput(C.value),Y.value=!Y.value},Z=async()=>{var e;F.value=!0;let n=new o;n.verseId=t.verseId,n.content=(null===(e=D.value)||void 0===e?void 0:e.getUserInput())??"";let i=await l.Lp.node.send(new l.cf({path:u.y$.blankItRightSubmit,data:n}));if(i.error){G.value=!0,J.value=a(i.error);return}let s=d.fromJson(i.data);R.value=s.answer,C.value=s.answer,B=n.content,S.value=s.score,$.value=3,await (0,r.Y3)(()=>{var e;null===(e=D.value)||void 0===e||e.initUserInput(B)}),F.value=!1},j=e=>{switch(e){case"blanking":return 1;case"blanked":return 2;case"finished":return 3;default:return 0}};return(e,t)=>{let n=(0,r.up)("nut-cell"),l=(0,r.up)("nut-button"),u=(0,r.up)("nut-col"),i=(0,r.up)("nut-row");return(0,r.wg)(),(0,r.iD)("div",h,[(0,r.Wm)(n,{innerHTML:z.value.replace(/\n/g,"<br>")},null,8,["innerHTML"]),(0,r.Wm)(f.Z,{content:R.value,disabled:y.value,"ignore-case":_.value,"ignore-punctuation":H.value,"ignore-content-indexes":T.value,"click-fill-char-when-disabled":L.value,ref_key:"typingRef",ref:D},null,8,["content","disabled","ignore-case","ignore-punctuation","ignore-content-indexes","click-fill-char-when-disabled"]),W.value==(0,r.SU)(s).getters.currentUserId&&1==$.value?((0,r.wg)(),(0,r.iD)("div",I,[(0,r.Wm)(i,{gutter:10},{default:(0,r.w5)(()=>[(0,r.Wm)(u,{span:12},{default:(0,r.w5)(()=>[(0,r.Wm)(l,{block:"",type:"info",onClick:M},{default:(0,r.w5)(()=>[(0,r.Uk)((0,r.zw)((0,r.SU)(a)("confirm")),1)]),_:1})]),_:1}),(0,r.Wm)(u,{span:12},{default:(0,r.w5)(()=>[(0,r.Wm)(l,{block:"",type:"info",onClick:A},{default:(0,r.w5)(()=>[(0,r.Uk)((0,r.zw)((0,r.SU)(a)("reset")),1)]),_:1})]),_:1})]),_:1})])):W.value!=(0,r.SU)(s).getters.currentUserId&&2==$.value?((0,r.wg)(),(0,r.iD)("div",k,[(0,r.Wm)(i,{gutter:10},{default:(0,r.w5)(()=>[(0,r.Wm)(u,{span:24},{default:(0,r.w5)(()=>[(0,r.Wm)(l,{block:"",type:"info",onClick:Z},{default:(0,r.w5)(()=>[(0,r.Uk)((0,r.zw)((0,r.SU)(a)("confirm")),1)]),_:1})]),_:1})]),_:1})])):W.value!=(0,r.SU)(s).getters.currentUserId&&3==$.value?((0,r.wg)(),(0,r.iD)("div",U,[(0,r.Wm)(n,null,{default:(0,r.w5)(()=>[(0,r.Uk)((0,r.zw)((0,r.SU)(a)("score")+": +"+S.value),1)]),_:1}),(0,r.Wm)(i,{gutter:10},{default:(0,r.w5)(()=>[(0,r.Wm)(u,{span:24},{default:(0,r.w5)(()=>[(0,r.Wm)(l,{block:"",type:"info",onClick:V},{default:(0,r.w5)(()=>[(0,r.Uk)((0,r.zw)(Y.value?(0,r.SU)(a)("viewSubmit"):(0,r.SU)(a)("viewAnswer")),1)]),_:1})]),_:1})]),_:1})])):(0,r.kq)("",!0)])}}}),b=m}}]);