<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Edit Book</title>
    <style>
        #editor {
            width: 100%;
            height: 400px;
        }

        label {
            font-family: sans-serif;
            font-size: 14px;
        }

        .commit-btn {
            background-color: #4CAF50; /* Green */
            border: none;
            color: white;
            padding: 10px 22px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 15px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }

        .commit-btn:hover {
            background-color: #45a049;
        }

        .commit-btn:active {
            transform: scale(0.97);
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.4/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.23.4/keybinding-vim.min.js"></script>
</head>
<body>
<h2>Edit Book<label>
    <input type="checkbox" id="vimToggle" onchange="toggleVimMode()"> Enable Vim Mode
</label></h2>

<div id="editor">{{BOOK}}</div>
<br/>
<button class="commit-btn" onclick="commit()">Commit</button>

<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/json");
    editor.setTheme("ace/theme/github");

    function toggleVimMode() {
        if (document.getElementById('vimToggle').checked) {
            editor.setKeyboardHandler("ace/keyboard/vim");
        } else {
            editor.setKeyboardHandler(null);
        }
    }

    async function commit() {
        const data = editor.getValue();
        try {
            const res = await fetch('/upload', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: data
            });
            const text = await res.text();
            alert("Server response: " + text);
        } catch (err) {
            alert("Error sending data: " + err);
        }
    }
</script>
</body>
</html>